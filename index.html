<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>ooops的小站</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="ooops的小站">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="ooops的小站">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="ooops的小站" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ooops的小站</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-2023/CTMediator" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/05/11/2023/CTMediator/" class="article-date">
  <time class="dt-published" datetime="2023-05-11T13:44:51.000Z" itemprop="datePublished">2023-05-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/05/11/2023/CTMediator/">CTMediator 组件完整性检查工具</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>公司项目组件化使用 <code>CTMediator</code> 作为路由, 实施过程中存在一个问题</p>
<p>业务路由中所定义的函数, 对应组件未在<code>target</code>中实现, 导致业务异常的问题</p>
<p>核心思想是遍历 <code>CTMediator</code> 的方法列表, 模拟真实业务下的函数调用, <code>hook</code>  <code>CTMediator</code> 的</p>
<p><code>NoTargetActionResponseWithTargetString:selectorString:originParams:</code></p>
<p><code>safePerformAction:target:params:</code></p>
<p><code>performTarget:action:params:shouldCacheTarget:</code></p>
<p>记录未实现路由的 <code>target</code> 及 <code>sel</code> 定位组件</p>
<p><code>.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  BTComponentCheckerTool.h</span></span><br><span class="line"><span class="comment">//  BTComponentChecker</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 张强 on 2023/4/13.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="string">&lt;CTMediator/CTMediator.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_BEGIN</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">BTComponentCheckerTool</span>: <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 检查所有 `Target` 是否实现了路由</span></span><br><span class="line">+ (<span class="type">void</span>)checkUnImpRouterFuncs;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">NS_ASSUME_NONNULL_END</span></span><br></pre></td></tr></table></figure>

<p><code>.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  BTComponentCheckerTool.m</span></span><br><span class="line"><span class="comment">//  BTComponentChecker</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"><span class="comment">//  Created by 张强 on 2023/4/13.</span></span><br><span class="line"><span class="comment">//</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="string">&quot;BTComponentCheckerTool.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="string">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"><span class="meta">#import <span class="string">&lt;objc/message.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#import <span class="string">&lt;BTBaseKit/BTWeakProxy.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 是否正在循环</span></span><br><span class="line"><span class="type">BOOL</span> isLoop = <span class="literal">NO</span>;</span><br><span class="line"><span class="comment">/// 记录所有组件未实现的路由</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSMutableArray</span>&lt;<span class="built_in">NSMutableDictionary</span>&lt;<span class="built_in">NSString</span>*, <span class="built_in">NSString</span>*&gt; *&gt; *__unImpRouterFuncs;</span><br><span class="line"><span class="comment">/// 扫描白名单</span></span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSArray</span>&lt;<span class="built_in">NSString</span> *&gt; *__whiteFuncsArray;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">BTComponentCheckerTool</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)checkUnImpRouterFuncs &#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> DEBUG</span></span><br><span class="line">    isLoop = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">if</span> (!__unImpRouterFuncs) &#123;</span><br><span class="line">        __unImpRouterFuncs = [<span class="built_in">NSMutableArray</span> array];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/// 配置扫描白名单</span></span><br><span class="line">    [<span class="keyword">self</span> configWhiteFuncs];</span><br><span class="line">    <span class="comment">/// 交换方法</span></span><br><span class="line">    [<span class="keyword">self</span> exchangeNoSelectorMethods];</span><br><span class="line">    [<span class="keyword">self</span> exchangeSafePerformMethods];</span><br><span class="line">    [<span class="keyword">self</span> exchangePerformMethods];</span><br><span class="line">    <span class="comment">/// 模拟路由调用</span></span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> count;</span><br><span class="line">    Method *m_list = class_copyMethodList(<span class="built_in">CTMediator</span>.class, &amp;count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; count; i++) &#123;</span><br><span class="line">        Method m = m_list[i];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">const</span> <span class="type">char</span> *m_name = sel_getName(method_getName(m));</span><br><span class="line">        <span class="built_in">NSString</span> *name = [<span class="built_in">NSString</span> stringWithCString:m_name encoding:<span class="built_in">NSUTF8StringEncoding</span>];</span><br><span class="line">        </span><br><span class="line">        SEL action = <span class="built_in">NSSelectorFromString</span>(name);</span><br><span class="line">        <span class="built_in">NSMethodSignature</span>* methodSig = [[<span class="built_in">CTMediator</span> sharedInstance] methodSignatureForSelector:action];</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ([<span class="keyword">self</span> unRouterWithMethodName:name]) <span class="keyword">continue</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/// 无参方法</span></span><br><span class="line">        <span class="keyword">if</span> (methodSig.numberOfArguments == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="built_in">NSInvocation</span> *invocation = [<span class="built_in">NSInvocation</span> invocationWithMethodSignature:methodSig];</span><br><span class="line">            [<span class="keyword">self</span> invocationWith:invocation methodName:name];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">// 根据具体类型进行参数判断调用</span></span><br><span class="line">            [<span class="keyword">self</span> invokeMethodSignature:methodSig methodName:name];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    free(m_list);</span><br><span class="line">    </span><br><span class="line">    isLoop = <span class="literal">NO</span>;</span><br><span class="line">    <span class="keyword">if</span> (__unImpRouterFuncs.count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    	<span class="comment">/// 打印未实现的路由</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@&quot;未实现的路由 %@&quot;</span>, __unImpRouterFuncs);</span><br><span class="line">        <span class="comment">/// 更加严厉的处理, 如直接结束进程</span></span><br><span class="line"><span class="comment">//        exit(1);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 模拟方法参数 - 调用</span></span><br><span class="line"><span class="comment">/// - Parameters:</span></span><br><span class="line"><span class="comment">///   - methodSignature: 方法签名</span></span><br><span class="line"><span class="comment">///   - methodName: 方法名</span></span><br><span class="line">+ (<span class="type">void</span>)invokeMethodSignature:(<span class="built_in">NSMethodSignature</span> *)methodSignature methodName:(<span class="built_in">NSString</span> *)methodName &#123;</span><br><span class="line">    <span class="keyword">if</span>(methodSignature == <span class="literal">nil</span>) <span class="keyword">return</span>;</span><br><span class="line">    <span class="built_in">NSInvocation</span> *invocation = [<span class="built_in">NSInvocation</span> invocationWithMethodSignature:methodSignature];</span><br><span class="line">    </span><br><span class="line">    <span class="type">id</span> target = [<span class="built_in">NSObject</span> new];</span><br><span class="line">    BTWeakProxy *obj = [BTWeakProxy proxyWithTarget:target];</span><br><span class="line">    </span><br><span class="line">    <span class="type">unsigned</span> <span class="type">int</span> u = <span class="number">0</span>;</span><br><span class="line">    <span class="type">double</span> d = <span class="number">1.0</span>;</span><br><span class="line">    <span class="type">void</span> (^sampleBlock)(<span class="type">void</span>) = ^() &#123; &#125;;</span><br><span class="line">    <span class="type">BOOL</span> b = <span class="literal">YES</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/// 设置方法参数</span></span><br><span class="line">    <span class="keyword">if</span> (methodSignature.numberOfArguments &gt; <span class="number">2</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; methodSignature.numberOfArguments - <span class="number">2</span>; i++) &#123;</span><br><span class="line">            <span class="built_in">NSInteger</span> realArgumentIndex = i + <span class="number">2</span>;</span><br><span class="line">            <span class="keyword">const</span> <span class="type">char</span> * argumentType = [methodSignature getArgumentTypeAtIndex:realArgumentIndex];</span><br><span class="line"></span><br><span class="line">            <span class="comment">/// BOOL 参数</span></span><br><span class="line">            <span class="keyword">if</span> (*argumentType == <span class="string">&#x27;B&#x27;</span>) &#123;</span><br><span class="line">                [invocation setArgument:&amp;b atIndex:realArgumentIndex];</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/// UInt64</span></span><br><span class="line">            <span class="keyword">if</span> (*argumentType == <span class="string">&#x27;Q&#x27;</span> || *argumentType == <span class="string">&#x27;q&#x27;</span>) &#123;</span><br><span class="line">                [invocation setArgument:&amp;u atIndex:realArgumentIndex];</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/// double</span></span><br><span class="line">            <span class="keyword">if</span> (*argumentType == <span class="string">&#x27;d&#x27;</span>) &#123;</span><br><span class="line">                [invocation setArgument:&amp;d atIndex:realArgumentIndex];</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">/// object or block</span></span><br><span class="line">            <span class="keyword">if</span> (*argumentType == <span class="string">&#x27;@&#x27;</span>) &#123;</span><br><span class="line">                size_t len = strlen(argumentType);</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (len == <span class="number">0</span>) &#123;</span><br><span class="line">                    [invocation setArgument:&amp;obj atIndex:realArgumentIndex];</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> (len == <span class="number">0</span>) &#123;</span><br><span class="line">                    [invocation setArgument:&amp;obj atIndex:realArgumentIndex];</span><br><span class="line">                    <span class="keyword">continue</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// block</span></span><br><span class="line">                <span class="keyword">if</span> (len == <span class="number">2</span> &amp;&amp; *(argumentType + <span class="number">1</span>) == <span class="string">&#x27;?&#x27;</span>) &#123;</span><br><span class="line">                    [invocation setArgument:&amp;sampleBlock atIndex:realArgumentIndex];</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    [invocation setArgument:&amp;obj atIndex:realArgumentIndex];</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> invocationWith:invocation methodName:methodName];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 调用方法</span></span><br><span class="line"><span class="comment">/// - Parameters:</span></span><br><span class="line"><span class="comment">///   - invocation: invocation description</span></span><br><span class="line"><span class="comment">///   - methodName: methodName description</span></span><br><span class="line">+ (<span class="type">void</span>)invocationWith:(<span class="built_in">NSInvocation</span> *)invocation methodName:(<span class="built_in">NSString</span> *)methodName &#123;</span><br><span class="line">    SEL action = <span class="built_in">NSSelectorFromString</span>(methodName);</span><br><span class="line">    [invocation setSelector:action];</span><br><span class="line">    [invocation setTarget:[<span class="built_in">CTMediator</span> sharedInstance]];</span><br><span class="line">    [invocation invoke];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark: - 交换 `CTMeditor` 的实现</span></span><br><span class="line"><span class="type">void</span> (*origin_NoTargetActionResponseWithTargetString)(<span class="type">id</span> _<span class="keyword">self</span>, SEL __cmd, <span class="built_in">NSString</span> *targetString, <span class="built_in">NSString</span> *selectorString, <span class="built_in">NSDictionary</span> *originParams, <span class="type">BOOL</span> shouldCacheTarget);</span><br><span class="line"><span class="type">void</span> swizzled_NoTargetActionResponseWithTargetString(<span class="type">id</span> _<span class="keyword">self</span>, SEL __cmd, <span class="built_in">NSString</span> *targetString, <span class="built_in">NSString</span> *selectorString, <span class="built_in">NSDictionary</span> *originParams, <span class="type">BOOL</span> shouldCacheTarget) &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 记录未实现路由及 `target`</span></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *dict = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">    dict[<span class="string">@&quot;target&quot;</span>] = targetString;</span><br><span class="line">    dict[<span class="string">@&quot;sel&quot;</span>] = selectorString;</span><br><span class="line">    [__unImpRouterFuncs addObject:dict];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (isLoop) &#123; <span class="keyword">return</span>; &#125;</span><br><span class="line">    origin_NoTargetActionResponseWithTargetString(_<span class="keyword">self</span>, __cmd, targetString, selectorString, originParams, shouldCacheTarget);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">id</span> (*origin_safePerformAction)(<span class="type">id</span> _<span class="keyword">self</span>, SEL __cmd, SEL action, <span class="built_in">NSObject</span> *target, <span class="built_in">NSDictionary</span> *params);</span><br><span class="line"><span class="type">id</span> swizzled_safePerformAction(<span class="type">id</span> _<span class="keyword">self</span>, SEL __cmd, SEL action, <span class="built_in">NSObject</span> *target, <span class="built_in">NSDictionary</span> *params) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isLoop) &#123; <span class="keyword">return</span> <span class="literal">nil</span>; &#125;</span><br><span class="line">    <span class="keyword">return</span> origin_safePerformAction(_<span class="keyword">self</span>, __cmd, action, target, params);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="type">id</span> (*origin_performAction)(<span class="type">id</span> _<span class="keyword">self</span>, SEL __cmd, <span class="built_in">NSString</span> *targetName, <span class="built_in">NSObject</span> *actionName, <span class="built_in">NSDictionary</span> *params, <span class="type">BOOL</span> shouldCacheTarget);</span><br><span class="line"><span class="type">id</span> swizzled_performAction(<span class="type">id</span> _<span class="keyword">self</span>, SEL __cmd, <span class="built_in">NSString</span> *targetName, <span class="built_in">NSObject</span> *actionName, <span class="built_in">NSDictionary</span> *params, <span class="type">BOOL</span> shouldCacheTarget) &#123;</span><br><span class="line">    <span class="keyword">if</span> (isLoop) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([params isKindOfClass:[BTWeakProxy <span class="keyword">class</span>]]) &#123;</span><br><span class="line">            params = @&#123;&#125;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> origin_performAction(_<span class="keyword">self</span>, __cmd, targetName, actionName, params, shouldCacheTarget);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)exchangeNoSelectorMethods &#123;</span><br><span class="line">    SEL noTargetSel = <span class="built_in">NSSelectorFromString</span>(<span class="string">@&quot;NoTargetActionResponseWithTargetString:selectorString:originParams:&quot;</span>);</span><br><span class="line">    Method m1 = class_getInstanceMethod(<span class="built_in">CTMediator</span>.class, noTargetSel);</span><br><span class="line">    origin_NoTargetActionResponseWithTargetString = method_setImplementation(m1, (IMP)swizzled_NoTargetActionResponseWithTargetString);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)exchangeSafePerformMethods &#123;</span><br><span class="line">    SEL safePerform = <span class="built_in">NSSelectorFromString</span>(<span class="string">@&quot;safePerformAction:target:params:&quot;</span>);</span><br><span class="line">    Method m1 = class_getInstanceMethod(<span class="built_in">CTMediator</span>.class, safePerform);</span><br><span class="line">    origin_safePerformAction = method_setImplementation(m1, (IMP)swizzled_safePerformAction);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="type">void</span>)exchangePerformMethods &#123;</span><br><span class="line">    SEL perform = <span class="built_in">NSSelectorFromString</span>(<span class="string">@&quot;performTarget:action:params:shouldCacheTarget:&quot;</span>);</span><br><span class="line">    Method m1 = class_getInstanceMethod(<span class="built_in">CTMediator</span>.class, perform);</span><br><span class="line">    origin_performAction = method_setImplementation(m1, (IMP)swizzled_performAction);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/// 判断方法是否需要模拟调用</span></span><br><span class="line"><span class="comment">/// - Parameter methodName: 方法名</span></span><br><span class="line">+ (<span class="type">BOOL</span>)unRouterWithMethodName:(<span class="built_in">NSString</span> *)methodName &#123;</span><br><span class="line">    __block <span class="type">BOOL</span> isWhite = <span class="literal">NO</span>;</span><br><span class="line">    [__whiteFuncsArray enumerateObjectsUsingBlock:^(<span class="built_in">NSString</span> * _Nonnull obj, <span class="built_in">NSUInteger</span> idx, <span class="type">BOOL</span> * _Nonnull stop) &#123;</span><br><span class="line">        <span class="keyword">if</span> ([methodName hasPrefix:obj]) &#123;</span><br><span class="line">            isWhite = <span class="literal">YES</span>;</span><br><span class="line">            *stop = <span class="literal">YES</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="keyword">return</span> isWhite;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/// 白名单可以按需修改</span></span><br><span class="line">+ (<span class="type">void</span>)configWhiteFuncs &#123;</span><br><span class="line">    <span class="keyword">if</span> (!__whiteFuncsArray) &#123;</span><br><span class="line">        __whiteFuncsArray = @[</span><br><span class="line">            <span class="string">@&quot;register&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;performActionWithUrl&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;performTarget&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;releaseCachedTargetWithFullTargetName&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;NoTargetActionResponseWithTargetString&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;safePerformAction&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;safeFetchCachedTarget&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;safeSetCachedTarget&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;setCachedTarget&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;presentViewController&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;pushViewController&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;cachedTarget&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;swizzled_performTarget&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;__get&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;integerValue&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;setCountryListIndicatorConfig&quot;</span>,</span><br><span class="line">            <span class="string">@&quot;getLoginThemeConfig&quot;</span>,</span><br><span class="line">        ];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2023/05/11/2023/CTMediator/" data-id="clm62vf1a000l6j9197go20qp" data-title="CTMediator 组件完整性检查工具" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2019/CI_ENV" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/12/2019/CI_ENV/" class="article-date">
  <time class="dt-published" datetime="2019-11-12T13:44:51.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/12/2019/CI_ENV/">自用 CI 环境搭建</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="自用-CI-环境搭建"><a href="#自用-CI-环境搭建" class="headerlink" title="自用 CI 环境搭建"></a>自用 CI 环境搭建</h2><h3 id="所需工具及环境"><a href="#所需工具及环境" class="headerlink" title="所需工具及环境"></a>所需工具及环境</h3><p><code>Jenkins 官网</code> <a target="_blank" rel="noopener" href="https://jenkins.io/zh/">Jenkins</a></p>
<p><code>Nodejs 环境安装 </code> <a target="_blank" rel="noopener" href="https://nodejs.org/en/">Nodejs</a><a href="">参考这里</a></p>
<p><code>Fastlane 官方文档</code>  <a target="_blank" rel="noopener" href="https://docs.fastlane.tools/">Fastlane 官方文档</a></p>
<p><code>Tomcat + Jenkins</code>  <a target="_blank" rel="noopener" href="http://urm9ril.top/2017/03/12/Jenkins/">参考</a></p>
<p><code>mySql 环境安装</code> <a target="_blank" rel="noopener" href="https://blog.csdn.net/w605283073/article/details/80417866">环境安装</a></p>
<p><code>STS 套件安装</code> <a target="_blank" rel="noopener" href="https://spring.io/tools3/sts/all">STS</a></p>
<p>相关操作</p>
<ul>
<li><a href="/2019/11/12/2019/STS/" title="STS">STS参考</a>
</li>
<li><a href="/2019/11/12/2019/MySQL/" title="MySQL">MySQL参考</a>
</li>
<li><a href="/2019/11/12/2019/Tomcat/" title="Tomcat">Tomcat参考</a>
</li>
<li><a href="/2019/11/12/2019/DataBase/" title="DataBase">DataBase参考</a>
</li>
<li><a href="/2019/11/12/2019/H5/" title="H5">H5参考</a>
</li>
<li><a href="/2019/11/12/2019/Fastlane/" title="Fastlane">Fastlane参考</a></li>
</ul>
<h4 id="对-Fastlane-CI-项目进行-修改"><a href="#对-Fastlane-CI-项目进行-修改" class="headerlink" title="对 Fastlane CI 项目进行 修改"></a>对 Fastlane CI 项目进行 修改</h4><p>阅读前, 请确保已经搭建好相关环境, 或阅读过 </p>
<a href="/2018/03/12/2018/Jenkins/" title="Jenkins一键发布ipa到蒲公英">Jenkins一键发布ipa到蒲公英</a>

<p>进入 构建项目的 <code>设置</code> <code>构建环境</code> <code>Execute shell</code> 修改为 <code>fastlane test</code></p>
<h4 id="运行测试"><a href="#运行测试" class="headerlink" title="运行测试"></a>运行测试</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br></pre></td><td class="code"><pre><span class="line">Started by user ooops</span><br><span class="line">Running as SYSTEM</span><br><span class="line">Building in workspace /Users/xxxxxx/.jenkins/workspace/JenkinsTest</span><br><span class="line">using credential 80ba6ebd-6283-4f44-9f24-a220389c234e</span><br><span class="line"> &gt; git rev-parse --is-inside-work-tree # timeout=10</span><br><span class="line">Fetching changes from the remote Git repository</span><br><span class="line"> &gt; git config remote.origin.url git@gitlab.xxxxxx.com.cn:ooops/Jenkins.git # timeout=10</span><br><span class="line">Fetching upstream changes from git@gitlab.xxxxxx.com.cn:ooops/Jenkins.git</span><br><span class="line"> &gt; git --version # timeout=10</span><br><span class="line">using GIT_SSH to set credentials </span><br><span class="line"> &gt; git fetch --tags --force --progress git@gitlab.xxxxxx.com.cn:ooops/Jenkins.git +refs/heads/*:refs/remotes/origin/*</span><br><span class="line"> &gt; git rev-parse refs/remotes/origin/master^&#123;commit&#125; # timeout=10</span><br><span class="line"> &gt; git rev-parse refs/remotes/origin/origin/master^&#123;commit&#125; # timeout=10</span><br><span class="line">Checking out Revision afe1f9d46d15bba769daa46552ccc11c598b9642 (refs/remotes/origin/master)</span><br><span class="line"> &gt; git config core.sparsecheckout # timeout=10</span><br><span class="line"> &gt; git checkout -f afe1f9d46d15bba769daa46552ccc11c598b9642</span><br><span class="line">Commit message: &quot;init project&quot;</span><br><span class="line"> &gt; git rev-list --no-walk afe1f9d46d15bba769daa46552ccc11c598b9642 # timeout=10</span><br><span class="line">[JenkinsTest] $ /bin/sh -xe /Users/xxxxxx/Library/Tomcat/temp/jenkins7807814047229248875.sh</span><br><span class="line">+ fastlane test</span><br><span class="line">[18:20:15]: [33mfastlane detected a Gemfile in the current directory[0m</span><br><span class="line">[18:20:15]: [33mhowever it seems like you don&#x27;t use `bundle exec`[0m</span><br><span class="line">[18:20:15]: [33mto launch fastlane faster, please use[0m</span><br><span class="line">[18:20:15]: </span><br><span class="line">[18:20:15]: [36m$ bundle exec fastlane test[0m</span><br><span class="line">[18:20:15]: </span><br><span class="line">[18:20:15]: [33mGet started using a Gemfile for fastlane https://docs.fastlane.tools/getting-started/ios/setup/#use-a-gemfile[0m</span><br><span class="line">+-----------------------+---------+--------+</span><br><span class="line">|               [32mUsed plugins[0m               |</span><br><span class="line">+-----------------------+---------+--------+</span><br><span class="line">| Plugin                | Version | Action |</span><br><span class="line">+-----------------------+---------+--------+</span><br><span class="line">| fastlane-plugin-pgyer | 0.2.2   | pgyer  |</span><br><span class="line">+-----------------------+---------+--------+</span><br><span class="line"></span><br><span class="line">[18:20:16]: [32m----------------------------------------[0m</span><br><span class="line">[18:20:16]: [32m--- Step: Verifying fastlane version ---[0m</span><br><span class="line">[18:20:16]: [32m----------------------------------------[0m</span><br><span class="line">[18:20:16]: Your fastlane version 2.135.2 matches the minimum requirement of 2.134.0  ✅</span><br><span class="line">[18:20:16]: [32m------------------------------[0m</span><br><span class="line">[18:20:16]: [32m--- Step: default_platform ---[0m</span><br><span class="line">[18:20:16]: [32m------------------------------[0m</span><br><span class="line">[18:20:16]: [32mDriving the lane &#x27;ios test&#x27; 🚀[0m</span><br><span class="line">[18:20:16]: [32m-----------------------[0m</span><br><span class="line">[18:20:16]: [32m--- Step: cocoapods ---[0m</span><br><span class="line">[18:20:16]: [32m-----------------------[0m</span><br><span class="line">[18:20:16]: [34m[1mUsing deprecated option: &#x27;--clean&#x27; (true)[0m</span><br><span class="line">[18:20:16]: [36m$ cd &#x27;.&#x27; &amp;&amp; pod install[0m</span><br><span class="line">[18:20:17]: ▸ [35mAnalyzing dependencies[0m</span><br><span class="line">[18:20:17]: ▸ [35mDownloading dependencies[0m</span><br><span class="line">[18:20:17]: ▸ [35mUsing Masonry (1.1.0)[0m</span><br><span class="line">[18:20:17]: ▸ [35mGenerating Pods project[0m</span><br><span class="line">[18:20:17]: ▸ [35mIntegrating client project[0m</span><br><span class="line">[18:20:17]: ▸ [35mSending stats[0m</span><br><span class="line">[18:20:17]: ▸ [35mPod installation complete! There is 1 dependency from the Podfile and 1 total pod installed.[0m</span><br><span class="line">[18:20:17]: ▸ [35m[!] Automatically assigning platform `ios` with version `13.1` on target `Jenkins` because no platform was specified. Please specify a platform for this target in your Podfile. See `https://guides.cocoapods.org/syntax/podfile.html#platform`.[0m</span><br><span class="line">[18:20:18]: 请输入版本描述:</span><br><span class="line">[18:20:18]: [32m-----------------------------[0m</span><br><span class="line">[18:20:18]: [32m--- Step: last_git_commit ---[0m</span><br><span class="line">[18:20:18]: [32m-----------------------------[0m</span><br><span class="line">[18:20:18]: </span><br><span class="line">Ad-Hoc - init project</span><br><span class="line"> &amp;#10 short_hash:afe1f9d</span><br><span class="line">[18:20:18]: [32m--------------------------------[0m</span><br><span class="line">[18:20:18]: [32m--- Step: get_version_number ---[0m</span><br><span class="line">[18:20:18]: [32m--------------------------------[0m</span><br><span class="line">[18:20:18]: </span><br><span class="line"></span><br><span class="line">+------------------------+---------+----------------------------+</span><br><span class="line">               [1;32mpacking[0m</span><br><span class="line">+--------------------+-----------------------+------------------+</span><br><span class="line">| schemeName            export_method          configuration    </span><br><span class="line">+--------------------+-----------------------+------------------+</span><br><span class="line">| Jenkins         development          Test-Debug  </span><br><span class="line">+--------------------+-----------------------+------------------+</span><br><span class="line">[18:20:18]: [32m-----------------[0m</span><br><span class="line">[18:20:18]: [32m--- Step: gym ---[0m</span><br><span class="line">[18:20:18]: [32m-----------------[0m</span><br><span class="line">[18:20:18]: [36m$ xcodebuild -showBuildSettings -workspace ./Jenkins.xcworkspace -scheme Jenkins -configuration Test-Debug[0m</span><br><span class="line">[18:20:20]: [31mCouldn&#x27;t find specified configuration &#x27;Test-Debug&#x27;.[0m</span><br><span class="line"></span><br><span class="line">+------------------------------------------+---------------------------------------------------------------+</span><br><span class="line">|                                         [32mSummary for gym 2.135.2[0m                                          |</span><br><span class="line">+------------------------------------------+---------------------------------------------------------------+</span><br><span class="line">| scheme                                   | Jenkins                                                       |</span><br><span class="line">| output_name                              | Jenkins                                                       |</span><br><span class="line">| clean                                    | true                                                          |</span><br><span class="line">| output_directory                         | /Users/xxxxxx/Library/Tomcat/webapps/app/ipa/afe1f9d      |</span><br><span class="line">| export_options.method                    | development                                                   |</span><br><span class="line">| export_options.manifest.appURL           | https://ios.xxxxxx.com.cn/app/ipa/afe1f9d/Jenkins.ipa     |</span><br><span class="line">| export_options.manifest.displayImageURL  | https://ios.xxxxxx.com.cn/app/a.png                       |</span><br><span class="line">| export_options.manifest.fullSizeImageURL | https://ios.xxxxxx.com.cn/app/b.png                       |</span><br><span class="line">| workspace                                | ./Jenkins.xcworkspace                                         |</span><br><span class="line">| destination                              | generic/platform=iOS                                          |</span><br><span class="line">| build_path                               | /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12 |</span><br><span class="line">| silent                                   | false                                                         |</span><br><span class="line">| skip_package_ipa                         | false                                                         |</span><br><span class="line">| result_bundle                            | false                                                         |</span><br><span class="line">| buildlog_path                            | ~/Library/Logs/gym                                            |</span><br><span class="line">| skip_profile_detection                   | false                                                         |</span><br><span class="line">| xcode_path                               | /Applications/Xcode.app                                       |</span><br><span class="line">+------------------------------------------+---------------------------------------------------------------+</span><br><span class="line"></span><br><span class="line">[18:20:20]: [36m$ set -o pipefail &amp;&amp; xcodebuild -workspace ./Jenkins.xcworkspace -scheme Jenkins -destination &#x27;generic/platform=iOS&#x27; -archivePath /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive clean archive | tee /Users/xxxxxx/Library/Logs/gym/Jenkins-Jenkins.log | xcpretty[0m</span><br><span class="line">[18:20:21]: [35m[33m▸[0m [39;1mClean[0m Succeeded[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m ViewController+MASAdditions.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m Masonry-umbrella.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m View+MASShorthandAdditions.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mProcessing[0m Masonry-Info.plist[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m View+MASAdditions.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m NSLayoutConstraint+MASDebugAdditions.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m NSArray+MASShorthandAdditions.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m NSArray+MASAdditions.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m Masonry.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m MASViewConstraint.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m MASViewAttribute.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m MASUtilities.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m MASLayoutConstraint.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m MASConstraintMaker.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m MASConstraint.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m MASConstraint+Private.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCopying[0m MASCompositeConstraint.h[0m</span><br><span class="line">[18:20:22]: [35m[33m▸[0m [39;1mCompiling[0m ViewController+MASAdditions.m[0m</span><br><span class="line">[18:20:24]: [35m[33m▸[0m [39;1mCompiling[0m View+MASAdditions.m[0m</span><br><span class="line">[18:20:24]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/View+MASAdditions.m:14:65: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:24]: ▸ [35m- (NSArray *)mas_makeConstraints:(void(^)(MASConstraintMaker *))block &#123;[0m</span><br><span class="line">[18:20:24]: ▸ [35m[36m                                                                ^[0m</span><br><span class="line">[18:20:24]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/View+MASAdditions.m:21:67: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:24]: ▸ [35m- (NSArray *)mas_updateConstraints:(void(^)(MASConstraintMaker *))block &#123;[0m</span><br><span class="line">[18:20:24]: ▸ [35m[36m                                                                                ^[0m</span><br><span class="line">[18:20:24]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/View+MASAdditions.m:29:71: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:24]: ▸ [35m- (NSArray *)mas_remakeConstraints:(void(^)(MASConstraintMaker *make))block &#123;[0m</span><br><span class="line">[18:20:24]: ▸ [35m[36m                                                                                  ^[0m</span><br><span class="line">[18:20:24]: [35m[33m▸[0m [39;1mCompiling[0m NSLayoutConstraint+MASDebugAdditions.m[0m</span><br><span class="line">[18:20:24]: [35m[33m▸[0m [39;1mCompiling[0m NSArray+MASAdditions.m[0m</span><br><span class="line">[18:20:24]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/NSArray+MASAdditions.m:14:69: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:24]: ▸ [35m- (NSArray *)mas_makeConstraints:(void(^)(MASConstraintMaker *make))block &#123;[0m</span><br><span class="line">[18:20:24]: ▸ [35m[36m                                                                                  ^[0m</span><br><span class="line">[18:20:24]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/NSArray+MASAdditions.m:23:71: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:24]: ▸ [35m- (NSArray *)mas_updateConstraints:(void(^)(MASConstraintMaker *make))block &#123;[0m</span><br><span class="line">[18:20:24]: ▸ [35m[36m                                                                                 ^[0m</span><br><span class="line">[18:20:24]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/NSArray+MASAdditions.m:32:71: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:24]: ▸ [35m- (NSArray *)mas_remakeConstraints:(void(^)(MASConstraintMaker *make))block &#123;[0m</span><br><span class="line">[18:20:24]: ▸ [35m[36m                                                                                   ^[0m</span><br><span class="line">[18:20:24]: [35m[33m▸[0m [39;1mCompiling[0m Masonry_vers.c[0m</span><br><span class="line">[18:20:24]: [35m[33m▸[0m [39;1mCompiling[0m Masonry-dummy.m[0m</span><br><span class="line">[18:20:24]: [35m[33m▸[0m [39;1mCompiling[0m MASViewConstraint.m[0m</span><br><span class="line">[18:20:24]: [35m[33m▸[0m [39;1mCompiling[0m MASViewAttribute.m[0m</span><br><span class="line">[18:20:24]: [35m[33m▸[0m [39;1mCompiling[0m MASLayoutConstraint.m[0m</span><br><span class="line">[18:20:24]: [35m[33m▸[0m [39;1mCompiling[0m MASConstraintMaker.m[0m</span><br><span class="line">[18:20:24]: [35m[33m▸[0m [39;1mCompiling[0m MASConstraint.m[0m</span><br><span class="line">[18:20:25]: [35m[33m▸[0m [39;1mCompiling[0m MASCompositeConstraint.m[0m</span><br><span class="line">[18:20:25]: [35m[33m▸[0m [39;1mCompiling[0m ViewController+MASAdditions.m[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m View+MASAdditions.m[0m</span><br><span class="line">[18:20:27]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/View+MASAdditions.m:14:65: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:27]: ▸ [35m- (NSArray *)mas_makeConstraints:(void(^)(MASConstraintMaker *))block &#123;[0m</span><br><span class="line">[18:20:27]: ▸ [35m[36m                                                                                   ^[0m</span><br><span class="line">[18:20:27]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/View+MASAdditions.m:21:67: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:27]: ▸ [35m- (NSArray *)mas_updateConstraints:(void(^)(MASConstraintMaker *))block &#123;[0m</span><br><span class="line">[18:20:27]: ▸ [35m[36m                                                                                ^[0m</span><br><span class="line">[18:20:27]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/View+MASAdditions.m:29:71: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:27]: ▸ [35m- (NSArray *)mas_remakeConstraints:(void(^)(MASConstraintMaker *make))block &#123;[0m</span><br><span class="line">[18:20:27]: ▸ [35m[36m                                                                                  ^[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m NSLayoutConstraint+MASDebugAdditions.m[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m NSArray+MASAdditions.m[0m</span><br><span class="line">[18:20:27]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/NSArray+MASAdditions.m:14:69: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:27]: ▸ [35m- (NSArray *)mas_makeConstraints:(void(^)(MASConstraintMaker *make))block &#123;[0m</span><br><span class="line">[18:20:27]: ▸ [35m[36m                                                                                  ^[0m</span><br><span class="line">[18:20:27]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/NSArray+MASAdditions.m:23:71: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:27]: ▸ [35m- (NSArray *)mas_updateConstraints:(void(^)(MASConstraintMaker *make))block &#123;[0m</span><br><span class="line">[18:20:27]: ▸ [35m[36m                                                                                 ^[0m</span><br><span class="line">[18:20:27]: ▸ [35m[33m⚠️  [0m/Users/xxxxxx/.jenkins/workspace/JenkinsTest/Pods/Masonry/Masonry/NSArray+MASAdditions.m:32:71: [33mparameter of overriding method should be annotated with __attribute__((noescape)) [-Wmissing-noescape][0m</span><br><span class="line">[18:20:27]: ▸ [35m- (NSArray *)mas_remakeConstraints:(void(^)(MASConstraintMaker *make))block &#123;[0m</span><br><span class="line">[18:20:27]: ▸ [35m[36m                                                                                   ^[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mLinking[0m Masonry[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m Masonry_vers.c[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m Masonry-dummy.m[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m MASViewConstraint.m[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m MASViewAttribute.m[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m MASLayoutConstraint.m[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m MASConstraintMaker.m[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m MASConstraint.m[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mCompiling[0m MASCompositeConstraint.m[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mLinking[0m Masonry[0m</span><br><span class="line">[18:20:27]: [35m[33m▸[0m [39;1mGenerating &#x27;Masonry.framework.dSYM&#x27;[0m</span><br><span class="line">[18:20:28]: [35m[33m▸[0m [39;1mTouching[0m Masonry.framework (in target &#x27;Masonry&#x27; from project &#x27;Pods&#x27;)[0m</span><br><span class="line">[18:20:28]: [35m[33m▸[0m [39;1mProcessing[0m Pods-Jenkins-Info.plist[0m</span><br><span class="line">[18:20:28]: [35m[33m▸[0m [39;1mCopying[0m Pods-Jenkins-umbrella.h[0m</span><br><span class="line">[18:20:28]: [35m[33m▸[0m [39;1mCompiling[0m Pods-Jenkins-dummy.m[0m</span><br><span class="line">[18:20:29]: [35m[33m▸[0m [39;1mCompiling[0m Pods_Jenkins_vers.c[0m</span><br><span class="line">[18:20:29]: [35m[33m▸[0m [39;1mTouching[0m Pods_Jenkins.framework (in target &#x27;Pods-Jenkins&#x27; from project &#x27;Pods&#x27;)[0m</span><br><span class="line">[18:20:29]: [35m[33m▸[0m [39;1mRunning script[0m &#x27;[CP] Check Pods Manifest.lock&#x27;[0m</span><br><span class="line">[18:20:29]: [35m[33m▸[0m [39;1mCompiling[0m main.m[0m</span><br><span class="line">[18:20:31]: [35m[33m▸[0m [39;1mCompiling[0m SceneDelegate.m[0m</span><br><span class="line">[18:20:31]: [35m[33m▸[0m [39;1mCompiling[0m ViewController.m[0m</span><br><span class="line">[18:20:31]: [35m[33m▸[0m [39;1mCompiling[0m AppDelegate.m[0m</span><br><span class="line">[18:20:31]: [35m[33m▸[0m [39;1mLinking[0m Jenkins[0m</span><br><span class="line">[18:20:32]: [35m[33m▸[0m [39;1mCompiling[0m Main.storyboard[0m</span><br><span class="line">[18:20:33]: [35m[33m▸[0m [39;1mCompiling[0m LaunchScreen.storyboard[0m</span><br><span class="line">[18:20:33]: [35m[33m▸[0m [39;1mProcessing[0m Info.plist[0m</span><br><span class="line">[18:20:33]: [35m[33m▸[0m [39;1mGenerating &#x27;Jenkins.app.dSYM&#x27;[0m</span><br><span class="line">[18:20:33]: [35m[33m▸[0m [39;1mRunning script[0m &#x27;[CP] Embed Pods Frameworks&#x27;[0m</span><br><span class="line">[18:20:34]: [35m[33m▸[0m [39;1mTouching[0m Jenkins.app (in target &#x27;Jenkins&#x27; from project &#x27;Jenkins&#x27;)[0m</span><br><span class="line">[18:20:34]: [35m[33m▸[0m [39;1mArchive[0m Succeeded[0m</span><br><span class="line">[18:20:34]: [33mGenerated plist file with the following values:[0m</span><br><span class="line">[18:20:34]: ▸ [35m-----------------------------------------[0m</span><br><span class="line">[18:20:34]: ▸ [35m&#123;[0m</span><br><span class="line">[18:20:34]: ▸ [35m  &quot;method&quot;: &quot;development&quot;,[0m</span><br><span class="line">[18:20:34]: ▸ [35m  &quot;manifest&quot;: &#123;[0m</span><br><span class="line">[18:20:34]: ▸ [35m    &quot;appURL&quot;: &quot;https://ios.xxxxxx.com.cn/app/ipa/afe1f9d/Jenkins.ipa&quot;,[0m</span><br><span class="line">[18:20:34]: ▸ [35m    &quot;displayImageURL&quot;: &quot;https://ios.xxxxxx.com.cn/app/a.png&quot;,[0m</span><br><span class="line">[18:20:34]: ▸ [35m    &quot;fullSizeImageURL&quot;: &quot;https://ios.xxxxxx.com.cn/app/b.png&quot;[0m</span><br><span class="line">[18:20:34]: ▸ [35m  &#125;[0m</span><br><span class="line">[18:20:34]: ▸ [35m&#125;[0m</span><br><span class="line">[18:20:34]: ▸ [35m-----------------------------------------[0m</span><br><span class="line">[18:20:34]: [36m$ /usr/bin/xcrun /Library/Ruby/Gems/2.3.0/gems/fastlane-2.135.2/gym/lib/assets/wrap_xcodebuild/xcbuild-safe.sh -exportArchive -exportOptionsPlist &#x27;/var/folders/4j/q9rj1lpd13lgz9t9fd60bs_h0000gn/T/gym_config20191112-12790-1s8sdqx.plist&#x27; -archivePath /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive -exportPath &#x27;/var/folders/4j/q9rj1lpd13lgz9t9fd60bs_h0000gn/T/gym_output20191112-12790-ngi2js&#x27; [0m</span><br><span class="line">[18:20:37]: Mapping dSYM(s) using generated BCSymbolMaps</span><br><span class="line">[18:20:37]: [36m$ dsymutil --symbol-map /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive/BCSymbolMaps/6D75071B-0037-384F-926F-8B1C1361029B.bcsymbolmap /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive/dSYMs/Masonry.framework.dSYM[0m</span><br><span class="line">[18:20:37]: [36m$ dsymutil --symbol-map /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive/BCSymbolMaps/767280BF-E897-396A-89C4-C434CC6D4567.bcsymbolmap /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive/dSYMs/Masonry.framework.dSYM[0m</span><br><span class="line">[18:20:38]: [36m$ dsymutil --symbol-map /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive/BCSymbolMaps/23A90BD7-3B62-3230-81A9-88F573B9B154.bcsymbolmap /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive/dSYMs/23A90BD7-3B62-3230-81A9-88F573B9B154.dSYM[0m</span><br><span class="line">warning: /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins 2019-11-12 18.20.20.xcarchive/BCSymbolMaps/23A90BD7-3B62-3230-81A9-88F573B9B154.bcsymbolmap: No such file or directory: not unobfuscating.</span><br><span class="line">[18:20:38]: [36m$ dsymutil --symbol-map /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive/BCSymbolMaps/B4A69CB4-BB3F-3714-BB41-23CB1697F350.bcsymbolmap /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive/dSYMs/Jenkins.app.dSYM[0m</span><br><span class="line">[18:20:38]: [36m$ dsymutil --symbol-map /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive/BCSymbolMaps/C5642B3B-9FDD-318D-A3AF-3D618762769A.bcsymbolmap /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins\ 2019-11-12\ 18.20.20.xcarchive/dSYMs/C5642B3B-9FDD-318D-A3AF-3D618762769A.dSYM[0m</span><br><span class="line">warning: /Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins 2019-11-12 18.20.20.xcarchive/BCSymbolMaps/C5642B3B-9FDD-318D-A3AF-3D618762769A.bcsymbolmap: No such file or directory: not unobfuscating.</span><br><span class="line">[18:20:38]: Compressing 4 dSYM(s)</span><br><span class="line">[18:20:38]: [36m$ cd &#x27;/Users/xxxxxx/Library/Developer/Xcode/Archives/2019-11-12/Jenkins 2019-11-12 18.20.20.xcarchive/dSYMs&#x27; &amp;&amp; zip -r &#x27;/Users/xxxxxx/Library/Tomcat/webapps/app/ipa/afe1f9d/Jenkins.app.dSYM.zip&#x27; *.dSYM[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: 23A90BD7-3B62-3230-81A9-88F573B9B154.dSYM/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: 23A90BD7-3B62-3230-81A9-88F573B9B154.dSYM/Contents/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: 23A90BD7-3B62-3230-81A9-88F573B9B154.dSYM/Contents/Resources/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: 23A90BD7-3B62-3230-81A9-88F573B9B154.dSYM/Contents/Resources/DWARF/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: 23A90BD7-3B62-3230-81A9-88F573B9B154.dSYM/Contents/Resources/DWARF/Jenkins (deflated 82%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: 23A90BD7-3B62-3230-81A9-88F573B9B154.dSYM/Contents/Resources/23A90BD7-3B62-3230-81A9-88F573B9B154.plist (deflated 21%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: 23A90BD7-3B62-3230-81A9-88F573B9B154.dSYM/Contents/Info.plist (deflated 52%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: C5642B3B-9FDD-318D-A3AF-3D618762769A.dSYM/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: C5642B3B-9FDD-318D-A3AF-3D618762769A.dSYM/Contents/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: C5642B3B-9FDD-318D-A3AF-3D618762769A.dSYM/Contents/Resources/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: C5642B3B-9FDD-318D-A3AF-3D618762769A.dSYM/Contents/Resources/DWARF/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: C5642B3B-9FDD-318D-A3AF-3D618762769A.dSYM/Contents/Resources/DWARF/Masonry (deflated 68%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: C5642B3B-9FDD-318D-A3AF-3D618762769A.dSYM/Contents/Resources/C5642B3B-9FDD-318D-A3AF-3D618762769A.plist (deflated 21%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: C5642B3B-9FDD-318D-A3AF-3D618762769A.dSYM/Contents/Info.plist (deflated 52%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Jenkins.app.dSYM/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Jenkins.app.dSYM/Contents/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Jenkins.app.dSYM/Contents/Resources/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Jenkins.app.dSYM/Contents/Resources/DWARF/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Jenkins.app.dSYM/Contents/Resources/DWARF/Jenkins (deflated 61%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Jenkins.app.dSYM/Contents/Info.plist (deflated 52%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Masonry.framework.dSYM/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Masonry.framework.dSYM/Contents/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Masonry.framework.dSYM/Contents/Resources/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Masonry.framework.dSYM/Contents/Resources/DWARF/ (stored 0%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Masonry.framework.dSYM/Contents/Resources/DWARF/Masonry (deflated 63%)[0m</span><br><span class="line">[18:20:38]: ▸ [35m  adding: Masonry.framework.dSYM/Contents/Info.plist (deflated 52%)[0m</span><br><span class="line"></span><br><span class="line">[18:20:38]: [32mSuccessfully exported and compressed dSYM file[0m</span><br><span class="line">[18:20:38]: [32mSuccessfully exported and signed the ipa file:[0m</span><br><span class="line">[18:20:38]: /Users/xxxxxx/Library/Tomcat/webapps/app/ipa/afe1f9d/Jenkins.ipa</span><br><span class="line">[18:20:38]: [32mSuccessfully exported the manifest.plist file:[0m</span><br><span class="line">[18:20:38]: /Users/xxxxxx/Library/Tomcat/webapps/app/ipa/afe1f9d/manifest.plist</span><br><span class="line">[18:20:38]: [32m--------------------------------------------------------------------[0m</span><br><span class="line">[18:20:38]: [32mStep: node /Users/xxxxxx/ipa/ios.js &#x27;APPName App - R&#x27; &#x27;https://ios.xxxxxx.com.cn/app/ipa/afe1f9d/Jenkins.ipa&#x27; &#x27;Ad-Hoc - init project</span><br><span class="line"> &amp;#10 short_hash:afe1f9d&#x27; &#x27;1.0&#x27; &#x27;https://ios.xxxxxx.com.cn/app/ipa/afe1f9d/manifest.plist&#x27;[0m</span><br><span class="line">[18:20:38]: [32m--------------------------------------------------------------------[0m</span><br><span class="line">[18:20:38]: [36m$ node /Users/xxxxxx/ipa/ios.js &#x27;APPName App - R&#x27; &#x27;https://ios.xxxxxx.com.cn/app/ipa/afe1f9d/Jenkins.ipa&#x27; &#x27;Ad-Hoc - init project</span><br><span class="line"> &amp;#10 short_hash:afe1f9d&#x27; &#x27;1.0&#x27; &#x27;https://ios.xxxxxx.com.cn/app/ipa/afe1f9d/manifest.plist&#x27;[0m</span><br><span class="line">[18:20:38]: ▸ [35m--------------------------INSERT----------------------------[0m</span><br><span class="line">[18:20:38]: ▸ [35mINSERT ID: OkPacket &#123;[0m</span><br><span class="line">[18:20:38]: ▸ [35mfieldCount: 0,[0m</span><br><span class="line">[18:20:38]: ▸ [35maffectedRows: 1,[0m</span><br><span class="line">[18:20:38]: ▸ [35minsertId: 65,[0m</span><br><span class="line">[18:20:38]: ▸ [35mserverStatus: 2,[0m</span><br><span class="line">[18:20:38]: ▸ [35mwarningCount: 0,[0m</span><br><span class="line">[18:20:38]: ▸ [35mmessage: &#x27;&#x27;,[0m</span><br><span class="line">[18:20:38]: ▸ [35mprotocol41: true,[0m</span><br><span class="line">[18:20:38]: ▸ [35mchangedRows: 0 &#125;[0m</span><br><span class="line">[18:20:38]: ▸ [35m-----------------------------------------------------------------[0m</span><br><span class="line"></span><br><span class="line">+------+------------------------------------------------------------------+-------------+</span><br><span class="line">|                                   [32mfastlane summary[0m                                    |</span><br><span class="line">+------+------------------------------------------------------------------+-------------+</span><br><span class="line">| Step | Action                                                           | Time (in s) |</span><br><span class="line">+------+------------------------------------------------------------------+-------------+</span><br><span class="line">| 1    | Verifying fastlane version                                       | 0           |</span><br><span class="line">| 2    | default_platform                                                 | 0           |</span><br><span class="line">| 3    | cocoapods                                                        | 1           |</span><br><span class="line">| 4    | last_git_commit                                                  | 0           |</span><br><span class="line">| 5    | get_version_number                                               | 0           |</span><br><span class="line">| 6    | gym                                                              | 19          |</span><br><span class="line">| 7    | node /Users/xxxxxx/ipa/ios.js &#x27;APPName App - R&#x27; &#x27;https://ios. | 0           |</span><br><span class="line">+------+------------------------------------------------------------------+-------------+</span><br><span class="line"></span><br><span class="line">[18:20:38]: [32mfastlane.tools finished successfully 🎉[0m</span><br><span class="line">Finished: SUCCESS</span><br></pre></td></tr></table></figure>



























      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/12/2019/CI_ENV/" data-id="clm62vf16000c6j919xkkdzkw" data-title="自用 CI 环境搭建" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2019/DataBase" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/12/2019/DataBase/" class="article-date">
  <time class="dt-published" datetime="2019-11-12T13:44:51.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/12/2019/DataBase/">DataBase</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="数据接口"><a href="#数据接口" class="headerlink" title="数据接口"></a>数据接口</h4><p>以下内容纯属现学现卖, low bee 的地方, 轻喷.</p>
<p>依赖工具</p>
<p><a target="_blank" rel="noopener" href="https://spring.io/tools3/sts/all">STS</a></p>
<p><a target="_blank" rel="noopener" href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">JDK</a></p>
<p><code>STS</code> 套件中新建一个 <code>Maven spring</code> 项目</p>
<p><code>pom.xml</code> 配置如下</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">project</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">modelVersion</span>&gt;</span>4.0.0<span class="tag">&lt;/<span class="name">modelVersion</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.7.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">relativePath</span>/&gt;</span> <span class="comment">&lt;!-- lookup parent from repository --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>consuming-rest<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>consuming-rest<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">description</span>&gt;</span>Demo project for Spring Boot<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--spring --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context-support<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- https://mvnrepository.com/artifact/mysql/mysql-connector-java --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- jar 包的名字 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>api<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">project</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>创建数据类 <code>IpaInfo</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.consumingrest.api;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IpaInfo</span> &#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String id;</span><br><span class="line">  <span class="keyword">private</span> String title;</span><br><span class="line">  <span class="keyword">private</span> String ver;</span><br><span class="line">  <span class="keyword">private</span> String url;</span><br><span class="line">  <span class="keyword">private</span> String des;</span><br><span class="line">  <span class="keyword">private</span> String mainfest;</span><br><span class="line">  <span class="keyword">private</span> String createTime;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">IpaInfo</span><span class="params">(String id, String title, String ver, String url, String des, String mainfest, String createTime)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">    <span class="built_in">this</span>.title = title;</span><br><span class="line">    <span class="built_in">this</span>.ver = ver;</span><br><span class="line">    <span class="built_in">this</span>.url = url;</span><br><span class="line">    <span class="built_in">this</span>.des = des;</span><br><span class="line">    <span class="built_in">this</span>.mainfest = mainfest;</span><br><span class="line">    <span class="built_in">this</span>.createTime = createTime;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> <span class="title function_">IpaInfo</span><span class="params">(String id, String title, String ver)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">    <span class="built_in">this</span>.title = title;</span><br><span class="line">    <span class="built_in">this</span>.ver = ver;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setId</span><span class="params">(String id)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = id;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getTitle</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> title;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTitle</span><span class="params">(String title)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.title = title;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getVer</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ver;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVer</span><span class="params">(String ver)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.ver = ver;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getUrl</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> url;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setUrl</span><span class="params">(String url)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.url = url;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getDes</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> des;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDes</span><span class="params">(String des)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.des = des;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getMainfest</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> mainfest;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMainfest</span><span class="params">(String mainfest)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.mainfest = mainfest;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Override</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> String.format(<span class="string">&quot;Customer[id=%s, title=&#x27;%s&#x27;, des=&#x27;%s&#x27;]&quot;</span>, id, title, des);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getCreateTime</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> createTime;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCreateTime</span><span class="params">(String createTime)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.createTime = createTime;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>创建分页类对象 <code>PackageInfo</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.consumingrest.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.consumingrest.api.IpaInfo;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PackageInfo</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> Integer currentPage;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Integer totalPage;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Integer totalRows;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> List&lt;IpaInfo&gt; ipaList;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">getCurrentPage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> currentPage;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCurrentPage</span><span class="params">(Integer currentPage)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.currentPage = currentPage;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">getTotalPage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> totalPage;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotalPage</span><span class="params">(Integer totalPage)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.totalPage = totalPage;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">getTotalRows</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> totalRows;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTotalRows</span><span class="params">(Integer totalRows)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.totalRows = totalRows;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> List&lt;IpaInfo&gt; <span class="title function_">getIpaList</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ipaList;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setIpaList</span><span class="params">(List&lt;IpaInfo&gt; ipaList)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.ipaList = ipaList;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>接口请求参数类对象 <code>PageObject</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.consumingrest.api;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PageObject</span> &#123;</span><br><span class="line">  <span class="keyword">public</span> Integer page;</span><br><span class="line">  <span class="keyword">public</span> Integer pageSize;</span><br><span class="line">  <span class="comment">/// 1 - ios, 2 - android</span></span><br><span class="line">  <span class="keyword">public</span> Integer platform;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">getPage</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> page;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPage</span><span class="params">(Integer page)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.page = page;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">getPageSize</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> pageSize;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPageSize</span><span class="params">(Integer pageSize)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.pageSize = pageSize;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> Integer <span class="title function_">getPlatform</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> platform;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPlatform</span><span class="params">(Integer platform)</span> &#123;</span><br><span class="line">    <span class="built_in">this</span>.platform = platform;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在 <code>com.example.consumingrest.api</code> 的包中创建 <code>ApiContorller</code>, 添加方法如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.consumingrest.api;</span><br><span class="line"><span class="keyword">import</span> java.util.Properties;</span><br><span class="line"><span class="keyword">import</span> java.sql.Connection;</span><br><span class="line"><span class="keyword">import</span> java.sql.PreparedStatement;</span><br><span class="line"><span class="keyword">import</span> java.sql.ResultSet;</span><br><span class="line"><span class="keyword">import</span> java.sql.SQLException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.CrossOrigin;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestBody;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"><span class="keyword">import</span> com.mysql.cj.jdbc.Driver;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="meta">@CrossOrigin</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ApiContorller</span> &#123;</span><br><span class="line">  <span class="meta">@RequestMapping(value = &quot;/list&quot;,consumes = MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">  <span class="meta">@PostMapping(value = &quot;/list&quot;,consumes = MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line">  <span class="keyword">public</span> PackageInfo <span class="title function_">ipa</span><span class="params">(<span class="meta">@RequestBody</span> PageObject obj)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="type">PackageInfo</span> <span class="variable">pa</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PackageInfo</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="type">Integer</span> <span class="variable">page</span> <span class="operator">=</span> obj.page;</span><br><span class="line">    </span><br><span class="line">    <span class="type">Integer</span> <span class="variable">size</span> <span class="operator">=</span> obj.pageSize;</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">limite</span> <span class="operator">=</span> String.valueOf(page * size);</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">offset</span> <span class="operator">=</span> String.valueOf(size * (page - <span class="number">1</span>));</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">tableName</span> <span class="operator">=</span> (obj.platform == <span class="number">1</span>) ? <span class="string">&quot;ipaInfo&quot;</span> : <span class="string">&quot;apkInfo&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    List&lt;IpaInfo&gt; ipaList = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;IpaInfo&gt;(); </span><br><span class="line">    </span><br><span class="line">    <span class="type">Driver</span> <span class="variable">driver</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">com</span>.mysql.cj.jdbc.Driver();</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> <span class="string">&quot;jdbc:mysql://localhost:3306/testFlight?useSSL=false&amp;serverTimezone=UTC&quot;</span>;</span><br><span class="line">    <span class="type">Properties</span> <span class="variable">info</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    info.put(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;root&quot;</span>);</span><br><span class="line">    info.put(<span class="string">&quot;password&quot;</span>, <span class="string">&quot;password&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> driver.connect(url, info);</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(!conn.isClosed())</span><br><span class="line">          System.out.println(<span class="string">&quot;Succeeded connecting to the Database!&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="type">String</span> <span class="variable">sql</span> <span class="operator">=</span> String.format(<span class="string">&quot;SELECT id, title, url, ver, des, mainfest, createTime FROM %s ORDER BY id DESC limit %s offset %s&quot;</span>, tableName, limite, offset);</span><br><span class="line">    </span><br><span class="line">    System.out.println(String.format(<span class="string">&quot;sql ; %s&quot;</span>, sql));</span><br><span class="line">    </span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">psta</span> <span class="operator">=</span> conn.prepareStatement(sql);</span><br><span class="line">    <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> psta.executeQuery();</span><br><span class="line">    <span class="keyword">while</span>(rs.next())&#123;</span><br><span class="line">      <span class="type">String</span> <span class="variable">id</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">appName</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;title&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">appUrl</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;url&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">ver</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;ver&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">description</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;des&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">mainfest</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;mainfest&quot;</span>);</span><br><span class="line">      <span class="type">String</span> <span class="variable">createTime</span> <span class="operator">=</span> rs.getString(<span class="string">&quot;createTime&quot;</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="type">IpaInfo</span> <span class="variable">info2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">IpaInfo</span>(id, appName, ver, appUrl, description, mainfest, createTime);</span><br><span class="line">      </span><br><span class="line">      ipaList.add(info2);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    pa.setCurrentPage(page);</span><br><span class="line">    </span><br><span class="line">    pa.setTotalPage(getTotalPage(conn, size, tableName));</span><br><span class="line">    </span><br><span class="line">    pa.setIpaList(ipaList);</span><br><span class="line">    </span><br><span class="line">    pa.setTotalRows(totalRows(conn, size, tableName));</span><br><span class="line">    </span><br><span class="line">    rs.close();</span><br><span class="line">    psta.close();</span><br><span class="line">    conn.close();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> pa;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// 总页数</span></span><br><span class="line">  <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTotalPage</span><span class="params">(Connection conn, Integer pageSize, String tableName)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> totalRows(conn, pageSize, tableName);</span><br><span class="line">      <span class="comment">//计算总页数公式</span></span><br><span class="line">      <span class="type">int</span> <span class="variable">totalPage</span> <span class="operator">=</span> count / pageSize + (count % pageSize &gt; <span class="number">0</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">      </span><br><span class="line">      <span class="keyword">return</span>  totalPage;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">/// 总记录数</span></span><br><span class="line">  <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">totalRows</span><span class="params">(Connection conn, Integer pageSize, String tableName)</span> <span class="keyword">throws</span> SQLException &#123;</span><br><span class="line">    <span class="type">PreparedStatement</span> <span class="variable">psta</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="type">ResultSet</span> <span class="variable">rs</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">      <span class="type">String</span> <span class="variable">strSql</span> <span class="operator">=</span> <span class="literal">null</span>;  </span><br><span class="line">      <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        strSql = String.format(<span class="string">&quot;SELECT count(id) FROM %S&quot;</span>, tableName);</span><br><span class="line">          psta = conn.prepareStatement(strSql);</span><br><span class="line">        rs = psta.executeQuery();</span><br><span class="line">          <span class="keyword">if</span>(rs.next()) &#123;</span><br><span class="line">              count =rs.getInt(<span class="number">1</span>);</span><br><span class="line">          &#125;</span><br><span class="line">          System.out.println(<span class="string">&quot;查询数据成功&quot;</span> + count);</span><br><span class="line">      &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">          e.printStackTrace();</span><br><span class="line">      &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"><span class="comment">//        rs.close();</span></span><br><span class="line"><span class="comment">//        psta.close();</span></span><br><span class="line"><span class="comment">//        conn.close();</span></span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">      <span class="keyword">return</span> count;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>修改 <code>application.properties</code> 为 <code>application.yml</code></p>
<p>内容修改为 </p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">      <span class="attr">port:</span> <span class="number">9000</span></span><br></pre></td></tr></table></figure>

<h5 id="直接运行项目"><a href="#直接运行项目" class="headerlink" title="直接运行项目"></a>直接运行项目</h5><blockquote>
<p>STS 内部会自动部署一个 <code>Tomcat</code> </p>
</blockquote>
<h5 id="生成-jar-包"><a href="#生成-jar-包" class="headerlink" title="生成 jar 包"></a>生成 <code>jar</code> 包</h5><p>通过 <code>右键</code> 项目 <code>Run As</code> <code>Maven install</code> 打包生成 <code>jar</code> 包</p>
<p>项目 <code>target</code> 文件夹下, 找到 <code>pom.xml</code> 中 <code>finalName</code> 配置的 <code>finalName.jar</code> 包</p>
<p>放入想要存储的文件夹</p>
<p>通过命令行启动  <code>jar</code> 包</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ java -jar api.jar</span><br></pre></td></tr></table></figure>

<h5 id="数据访问"><a href="#数据访问" class="headerlink" title="数据访问"></a>数据访问</h5><p>通过浏览器访问 <code>http://localhost:9000/list</code></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">This application has no explicit mapping for /error, so you are seeing this as a fallback.</span><br><span class="line"></span><br><span class="line">Tue Nov 12 17:07:17 CST 2019</span><br><span class="line">There was an unexpected error (type=Unsupported Media Type, status=415).</span><br><span class="line">Content type &#x27;&#x27; not supported</span><br></pre></td></tr></table></figure>

<p>显然是拒绝的, 没有编写 <code>GET</code> 访问</p>
<p>通过 <code>postman</code> 访问</p>
<p>请求参数</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;page&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;pageSize&quot;</span><span class="punctuation">:</span> <span class="number">20</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;platform&quot;</span><span class="punctuation">:</span> <span class="number">1</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<p>返回值</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;currentPage&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalPage&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;totalRows&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;ipaList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;title&quot;</span><span class="punctuation">:</span> <span class="string">&quot;APPName&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;ver&quot;</span><span class="punctuation">:</span> <span class="string">&quot;v0.0.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;url&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://.../xxxx.ipa&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;des&quot;</span><span class="punctuation">:</span> <span class="string">&quot;下单问题修改&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;mainfest&quot;</span><span class="punctuation">:</span> <span class="string">&quot;https://..../manifest.plist&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;createTime&quot;</span><span class="punctuation">:</span> <span class="string">&quot;2019-11-08 12:54:20&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>...<span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span>...<span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>由于自己部署的 <code>Tomcat</code> 下的 <code>webapp</code> 已经被运维同学, 通过 <code>Nginx</code> 转发为 <code>HTTPS</code>, </p>
<p>并绑定了 9000 端口号.所以这里修改 <code>STS</code> 下的默认端口号为 9000, 以便数据接口能够通过绑定的域名进行访问</p>
<p>因此 <code>POST</code> 访问的地址可以变更为 <code>https://xxxxxxx.com/list</code></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/12/2019/DataBase/" data-id="clm62vf17000d6j91d13w34tf" data-title="DataBase" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2019/Fastlane" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/12/2019/Fastlane/" class="article-date">
  <time class="dt-published" datetime="2019-11-12T13:44:51.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/12/2019/Fastlane/">Fastlane</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="Fastlane-的安装"><a href="#Fastlane-的安装" class="headerlink" title="Fastlane 的安装"></a>Fastlane 的安装</h4><p><code>Fastlane 官方文档</code>  <a target="_blank" rel="noopener" href="https://docs.fastlane.tools/">Fastlane 官方文档</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ xcode-select --install</span><br><span class="line"></span><br><span class="line">出现 </span><br><span class="line">xcode-select: error: <span class="built_in">command</span> line tools are already installed, use <span class="string">&quot;Software Update&quot;</span> to install updates</span><br><span class="line">表示已经安装过 xcode <span class="built_in">command</span> line tools</span><br></pre></td></tr></table></figure>

<p>继续执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gem install -n /usr/local/bin fastlane -NV</span><br><span class="line"></span><br><span class="line">......</span><br><span class="line">Successfully installed fastlane-2.130.0</span><br><span class="line">1 gem installed</span><br></pre></td></tr></table></figure>

<p>安装 Fastlane</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ brew install fastlane</span><br><span class="line">.......</span><br><span class="line">After doing so close the terminal session and restart it to start using fastlane ?</span><br><span class="line">?  fastlane was successfully installed!</span><br></pre></td></tr></table></figure>

<h5 id="对-Jenkins-构建项目实行-fastlane-化构建"><a href="#对-Jenkins-构建项目实行-fastlane-化构建" class="headerlink" title="对 Jenkins 构建项目实行 fastlane 化构建"></a>对 Jenkins 构建项目实行 <code>fastlane</code> 化构建</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> /Users/your_user_name/.jenkins/workspace/your project </span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ fastlane init</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[✔] Looking <span class="keyword">for</span> iOS and Android projects <span class="keyword">in</span> current directory...</span><br><span class="line">[15:03:11]: Created new folder <span class="string">&#x27;./fastlane&#x27;</span>.</span><br><span class="line">[15:03:11]: Detected an iOS/macOS project <span class="keyword">in</span> the current directory: <span class="string">&#x27;Jenkins.xcworkspace&#x27;</span></span><br><span class="line">[15:03:11]: -----------------------------</span><br><span class="line">[15:03:11]: --- Welcome to fastlane 🚀 ---</span><br><span class="line">[15:03:11]: -----------------------------</span><br><span class="line">[15:03:11]: fastlane can <span class="built_in">help</span> you with all kinds of automation <span class="keyword">for</span> your mobile app</span><br><span class="line">[15:03:11]: We recommend automating one task first, and <span class="keyword">then</span> gradually automating more over time</span><br><span class="line">[15:03:11]: What would you like to use fastlane <span class="keyword">for</span>?</span><br><span class="line">1. 📸  Automate screenshots</span><br><span class="line">2. 👩‍✈️  Automate beta distribution to TestFlight</span><br><span class="line">3. 🚀  Automate App Store distribution</span><br><span class="line">4. 🛠  Manual setup - manually setup your project to automate your tasks</span><br><span class="line">?  4</span><br><span class="line">[15:03:22]: ------------------------------------------------------------</span><br><span class="line">[15:03:22]: --- Setting up fastlane so you can manually configure it ---</span><br><span class="line">[15:03:22]: ------------------------------------------------------------</span><br><span class="line">[15:03:22]: Installing dependencies <span class="keyword">for</span> you...</span><br><span class="line">[15:03:22]: $ bundle update</span><br></pre></td></tr></table></figure>
<p>这里可以去喝个咖啡 &#x2F; 抽根烟啥的. 还可以 更换 <code>gem</code> 源.<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7f9c7168eb5e">如果 <code>Fastlane bundle update</code> 卡住解决方案</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">[Jenkins:Jenkins ooops$ fastlane init</span><br><span class="line">[✔] 🚀 </span><br><span class="line">[✔] Looking <span class="keyword">for</span> iOS and Android projects <span class="keyword">in</span> current directory...</span><br><span class="line">[15:03:11]: Created new folder <span class="string">&#x27;./fastlane&#x27;</span>.</span><br><span class="line">[15:03:11]: Detected an iOS/macOS project <span class="keyword">in</span> the current directory: <span class="string">&#x27;Jenkins.xcworkspace&#x27;</span></span><br><span class="line">[15:03:11]: -----------------------------</span><br><span class="line">[15:03:11]: --- Welcome to fastlane 🚀 ---</span><br><span class="line">[15:03:11]: -----------------------------</span><br><span class="line">[15:03:11]: fastlane can <span class="built_in">help</span> you with all kinds of automation <span class="keyword">for</span> your mobile app</span><br><span class="line">[15:03:11]: We recommend automating one task first, and <span class="keyword">then</span> gradually automating more over time</span><br><span class="line">[15:03:11]: What would you like to use fastlane <span class="keyword">for</span>?</span><br><span class="line">1. 📸  Automate screenshots</span><br><span class="line">2. 👩‍✈️  Automate beta distribution to TestFlight</span><br><span class="line">3. 🚀  Automate App Store distribution</span><br><span class="line">4. 🛠  Manual setup - manually setup your project to automate your tasks</span><br><span class="line">?  4</span><br><span class="line">[15:03:22]: ------------------------------------------------------------</span><br><span class="line">[15:03:22]: --- Setting up fastlane so you can manually configure it ---</span><br><span class="line">[15:03:22]: ------------------------------------------------------------</span><br><span class="line">[15:03:22]: Installing dependencies <span class="keyword">for</span> you...</span><br><span class="line">[15:03:22]: $ bundle update</span><br><span class="line">^C^C</span><br><span class="line">Cancelled... use --verbose to show the stack trace</span><br><span class="line">Jenkins:Jenkins ooops$ </span><br><span class="line">Jenkins:Jenkins ooops$ </span><br><span class="line">Jenkins:Jenkins ooops$ gem sources --add https://gems.ruby-china.com/ --remove https://rubygems.org/</span><br><span class="line"><span class="built_in">source</span> https://gems.ruby-china.com/ already present <span class="keyword">in</span> the cache</span><br><span class="line"><span class="built_in">source</span> https://rubygems.org/ not present <span class="keyword">in</span> cache</span><br><span class="line">Jenkins:Jenkins ooops$ fastlane init</span><br><span class="line">[✔] 🚀 </span><br><span class="line">[15:10:58]: ------------------------------</span><br><span class="line">[15:10:58]: --- Step: default_platform ---</span><br><span class="line">[15:10:58]: ------------------------------</span><br><span class="line"></span><br><span class="line">--------- ios---------</span><br><span class="line">----- fastlane ios custom_lane</span><br><span class="line">Description of what the lane does</span><br><span class="line"></span><br><span class="line">Execute using `fastlane [lane_name]`</span><br><span class="line">[15:10:58]: ------------------</span><br><span class="line">[15:10:58]: fastlane is already <span class="built_in">set</span> up at path `./fastlane/`, see the available lanes above</span><br><span class="line">[15:10:58]: </span><br><span class="line">[15:10:58]: ------------------------------</span><br><span class="line">[15:10:58]: --- Where to go from here? ---</span><br><span class="line">[15:10:58]: ------------------------------</span><br><span class="line">[15:10:58]: 📸  Learn more about how to automatically generate localized App Store screenshots:</span><br><span class="line">[15:10:58]:         https://docs.fastlane.tools/getting-started/ios/screenshots/</span><br><span class="line">[15:10:58]: 👩‍✈️  Learn more about distribution to beta testing services:</span><br><span class="line">[15:10:58]:         https://docs.fastlane.tools/getting-started/ios/beta-deployment/</span><br><span class="line">[15:10:58]: 🚀  Learn more about how to automate the App Store release process:</span><br><span class="line">[15:10:58]:         https://docs.fastlane.tools/getting-started/ios/appstore-deployment/</span><br><span class="line">[15:10:58]: 👩‍⚕️  Learn more about how to setup code signing with fastlane</span><br><span class="line">[15:10:58]:         https://docs.fastlane.tools/codesigning/getting-started/</span><br><span class="line">Jenkins:Jenkins ooops$ fastlane init</span><br><span class="line">[✔] 🚀 </span><br><span class="line">[✔] Looking <span class="keyword">for</span> iOS and Android projects <span class="keyword">in</span> current directory...</span><br><span class="line">[15:40:42]: Created new folder <span class="string">&#x27;./fastlane&#x27;</span>.</span><br><span class="line">[15:40:42]: Detected an iOS/macOS project <span class="keyword">in</span> the current directory: <span class="string">&#x27;Jenkins.xcworkspace&#x27;</span></span><br><span class="line">[15:40:42]: -----------------------------</span><br><span class="line">[15:40:42]: --- Welcome to fastlane 🚀 ---</span><br><span class="line">[15:40:42]: -----------------------------</span><br><span class="line">[15:40:42]: fastlane can <span class="built_in">help</span> you with all kinds of automation <span class="keyword">for</span> your mobile app</span><br><span class="line">[15:40:42]: We recommend automating one task first, and <span class="keyword">then</span> gradually automating more over time</span><br><span class="line">[15:40:42]: What would you like to use fastlane <span class="keyword">for</span>?</span><br><span class="line">1. 📸  Automate screenshots</span><br><span class="line">2. 👩‍✈️  Automate beta distribution to TestFlight</span><br><span class="line">3. 🚀  Automate App Store distribution</span><br><span class="line">4. 🛠  Manual setup - manually setup your project to automate your tasks</span><br><span class="line">?  4</span><br><span class="line">[15:40:45]: ------------------------------------------------------------</span><br><span class="line">[15:40:45]: --- Setting up fastlane so you can manually configure it ---</span><br><span class="line">[15:40:45]: ------------------------------------------------------------</span><br><span class="line">[15:40:45]: --------------------------------------------------------</span><br><span class="line">[15:40:45]: --- ✅  Successfully generated fastlane configuration ---</span><br><span class="line">[15:40:45]: --------------------------------------------------------</span><br><span class="line">[15:40:45]: Generated Fastfile at path `./fastlane/Fastfile`</span><br><span class="line">[15:40:45]: Generated Appfile at path `./fastlane/Appfile`</span><br><span class="line">[15:40:45]: Gemfile and Gemfile.lock at path `Gemfile`</span><br><span class="line">[15:40:45]: Please check the newly generated configuration files into git along with your project</span><br><span class="line">[15:40:45]: This way everyone <span class="keyword">in</span> your team can benefit from your fastlane setup</span><br><span class="line">[15:40:45]: Continue by pressing Enter ⏎</span><br><span class="line"></span><br><span class="line">[15:40:47]: fastlane will collect the number of errors <span class="keyword">for</span> each action to detect integration issues</span><br><span class="line">[15:40:47]: No sensitive/private information will be uploaded, more information: https://docs.fastlane.tools/<span class="comment">#metrics</span></span><br><span class="line">[15:40:47]: ----------------------</span><br><span class="line">[15:40:47]: --- fastlane lanes ---</span><br><span class="line">[15:40:47]: ----------------------</span><br><span class="line">[15:40:47]: fastlane uses a `Fastfile` to store the automation configuration</span><br><span class="line">[15:40:47]: Within that, you<span class="string">&#x27;ll see different lanes.</span></span><br><span class="line"><span class="string">[15:40:47]: Each is there to automate a different task, like screenshots, code signing, or pushing new releases</span></span><br><span class="line"><span class="string">[15:40:47]: Continue by pressing Enter ⏎</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[15:40:49]: --------------------------------------</span></span><br><span class="line"><span class="string">[15:40:49]: --- How to customize your Fastfile ---</span></span><br><span class="line"><span class="string">[15:40:49]: --------------------------------------</span></span><br><span class="line"><span class="string">[15:40:49]: Use a text editor of your choice to open the newly created Fastfile and take a look</span></span><br><span class="line"><span class="string">[15:40:49]: You can now edit the available lanes and actions to customize the setup to fit your needs</span></span><br><span class="line"><span class="string">[15:40:49]: To get a list of all the available actions, open https://docs.fastlane.tools/actions</span></span><br><span class="line"><span class="string">[15:40:49]: Continue by pressing Enter ⏎</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[15:40:51]: ------------------------------</span></span><br><span class="line"><span class="string">[15:40:51]: --- Where to go from here? ---</span></span><br><span class="line"><span class="string">[15:40:51]: ------------------------------</span></span><br><span class="line"><span class="string">[15:40:51]: 📸  Learn more about how to automatically generate localized App Store screenshots:</span></span><br><span class="line"><span class="string">[15:40:51]:         https://docs.fastlane.tools/getting-started/ios/screenshots/</span></span><br><span class="line"><span class="string">[15:40:51]: 👩‍✈️  Learn more about distribution to beta testing services:</span></span><br><span class="line"><span class="string">[15:40:51]:         https://docs.fastlane.tools/getting-started/ios/beta-deployment/</span></span><br><span class="line"><span class="string">[15:40:51]: 🚀  Learn more about how to automate the App Store release process:</span></span><br><span class="line"><span class="string">[15:40:51]:         https://docs.fastlane.tools/getting-started/ios/appstore-deployment/</span></span><br><span class="line"><span class="string">[15:40:51]: 👩‍⚕️  Learn more about how to setup code signing with fastlane</span></span><br><span class="line"><span class="string">[15:40:51]:         https://docs.fastlane.tools/codesigning/getting-started/</span></span><br><span class="line"><span class="string">[15:40:51]: </span></span><br><span class="line"><span class="string">[15:40:51]: To try your new fastlane setup, just enter and run</span></span><br><span class="line"><span class="string">[15:40:51]: $ fastlane custom_lane</span></span><br></pre></td></tr></table></figure>

<p>执行 <code>fastlane custom_lane</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">Jenkins:Jenkins ooops$ fastlane custom_lane</span><br><span class="line">[✔] 🚀 </span><br><span class="line">[15:41:10]: fastlane detected a Gemfile <span class="keyword">in</span> the current directory</span><br><span class="line">[15:41:10]: however it seems like you don<span class="string">&#x27;t use `bundle exec`</span></span><br><span class="line"><span class="string">[15:41:10]: to launch fastlane faster, please use</span></span><br><span class="line"><span class="string">[15:41:10]: </span></span><br><span class="line"><span class="string">[15:41:10]: $ bundle exec fastlane custom_lane</span></span><br><span class="line"><span class="string">[15:41:10]: </span></span><br><span class="line"><span class="string">[15:41:10]: Get started using a Gemfile for fastlane https://docs.fastlane.tools/getting-started/ios/setup/#use-a-gemfile</span></span><br><span class="line"><span class="string">[15:41:12]: ------------------------------</span></span><br><span class="line"><span class="string">[15:41:12]: --- Step: default_platform ---</span></span><br><span class="line"><span class="string">[15:41:12]: ------------------------------</span></span><br><span class="line"><span class="string">[15:41:12]: Driving the lane &#x27;</span>ios custom_lane<span class="string">&#x27; 🚀</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">+------+------------------+-------------+</span></span><br><span class="line"><span class="string">|           fastlane summary            |</span></span><br><span class="line"><span class="string">+------+------------------+-------------+</span></span><br><span class="line"><span class="string">| Step | Action           | Time (in s) |</span></span><br><span class="line"><span class="string">+------+------------------+-------------+</span></span><br><span class="line"><span class="string">| 1    | default_platform | 0           |</span></span><br><span class="line"><span class="string">+------+------------------+-------------+</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[15:41:12]: fastlane.tools finished successfully 🎉</span></span><br><span class="line"><span class="string">Jenkins:Jenkins ooops$ </span></span><br></pre></td></tr></table></figure>

<h4 id="ipa-可以内测分发的条件"><a href="#ipa-可以内测分发的条件" class="headerlink" title="ipa 可以内测分发的条件"></a>ipa 可以内测分发的条件</h4><p>1 - 配置必要的打包证书</p>
<p>2 - 支持 <code>HTTPS</code> 访问的服务器</p>
<p>3 - 一个用来提供下载 <code>ipa</code> 文件的网页</p>
<h4 id="fastlane-脚本编写"><a href="#fastlane-脚本编写" class="headerlink" title="fastlane 脚本编写"></a>fastlane 脚本编写</h4><h6 id="修改-Fastfile-文件"><a href="#修改-Fastfile-文件" class="headerlink" title="修改 Fastfile 文件"></a>修改 <code>Fastfile</code> 文件</h6><p>初始脚本如下</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">default_platform(<span class="symbol">:ios</span>)</span><br><span class="line"></span><br><span class="line">platform <span class="symbol">:ios</span> <span class="keyword">do</span></span><br><span class="line">  desc <span class="string">&quot;Description of what the lane does&quot;</span></span><br><span class="line">  lane <span class="symbol">:custom_lane</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>修改 <code>lane</code> 自定义命令</p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">default_platform(<span class="symbol">:ios</span>)</span><br><span class="line"></span><br><span class="line">platform <span class="symbol">:ios</span> <span class="keyword">do</span></span><br><span class="line">  desc <span class="string">&quot;Description of what the lane does&quot;</span></span><br><span class="line">  lane <span class="symbol">:test</span> <span class="keyword">do</span></span><br><span class="line">  <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<p>最终脚本如下</p>
<p>更多语法可以参考 <a target="_blank" rel="noopener" href="https://docs.fastlane.tools/">Fastlane 官方文档</a></p>
<figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># This file contains the fastlane.tools configuration</span></span><br><span class="line"><span class="comment"># You can find the documentation at https://docs.fastlane.tools</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For a list of all available actions, check out</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     https://docs.fastlane.tools/actions</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># For a list of all available plugins, check out</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#     https://docs.fastlane.tools/plugins/available-plugins</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment the line if you want fastlane to automatically update itself</span></span><br><span class="line"><span class="comment"># update_fastlane</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 定义打包平台</span></span><br><span class="line">default_platform <span class="symbol">:ios</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 蒲公英api_key和user_key</span></span><br><span class="line"><span class="comment"># 蒲公英账号</span></span><br><span class="line"><span class="comment"># api_key=&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxXXX&quot;</span></span><br><span class="line"><span class="comment"># user_key=&quot;xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxXXX&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 任务脚本 -----------------------------------</span></span><br><span class="line">platform <span class="symbol">:ios</span> <span class="keyword">do</span></span><br><span class="line">lane <span class="symbol">:test</span> <span class="keyword">do</span>|<span class="params">options</span>|</span><br><span class="line">branch = options[<span class="symbol">:branch</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># cocoapods 支持</span></span><br><span class="line">cocoapods(</span><br><span class="line">  <span class="symbol">clean:</span> <span class="literal">true</span>,</span><br><span class="line">  <span class="symbol">use_bundle_exec:</span> <span class="literal">false</span>,</span><br><span class="line">  <span class="symbol">podfile:</span> <span class="string">&quot;./Podfile&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># puts &quot;\n</span></span><br><span class="line"><span class="comment"># +------------------------+---------+------------------+</span></span><br><span class="line"><span class="comment"># |     \033[1;32mchoice scheme\033[0m                    |</span></span><br><span class="line"><span class="comment"># +---------------+--------+---------+------------------+</span></span><br><span class="line"><span class="comment"># | scheme        |  Index | version | Description      |</span></span><br><span class="line"><span class="comment"># +---------------+--------+---------+------------------+</span></span><br><span class="line"><span class="comment"># | development   |   1    | Test    | Test-Package     |</span></span><br><span class="line"><span class="comment"># +---------------+--------+---------+------------------+</span></span><br><span class="line"><span class="comment"># | ad-hoc        |   2    | Release | ad-hoc-Package   |</span></span><br><span class="line"><span class="comment"># +---------------+--------+---------+------------------+</span></span><br><span class="line"><span class="comment"># | app-store     |   3    | Release | app-store-Package|</span></span><br><span class="line"><span class="comment"># +---------------+--------+---------+------------------+</span></span><br><span class="line"><span class="comment"># &quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#自选scheme</span></span><br><span class="line">    <span class="comment"># schemeName 输出的ipa名称的前缀, 也是 xcode 中 scheme 的名字</span></span><br><span class="line">    <span class="comment"># export_method 指定打包所使用的输出方式，目前支持app-store, package, ad-hoc, enterprise, development</span></span><br><span class="line">    <span class="comment"># configuration 指定打包方式，Release 或者 Debug , Test-Debug</span></span><br><span class="line">    scheme=<span class="string">&quot;1&quot;</span><span class="comment">#STDIN.gets</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> scheme == <span class="string">&quot;1&quot;</span></span><br><span class="line"></span><br><span class="line">    schemeName = <span class="string">&quot;Jenkins&quot;</span></span><br><span class="line">    export_method = <span class="string">&quot;development&quot;</span></span><br><span class="line">    configuration = <span class="string">&quot;Test-Debug&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">elsif</span> scheme == <span class="string">&quot;2&quot;</span></span><br><span class="line"></span><br><span class="line">    schemeName = <span class="string">&quot;Jenkins&quot;</span></span><br><span class="line">    export_method = <span class="string">&quot;ad-hoc&quot;</span></span><br><span class="line">    configuration = <span class="string">&quot;Release&quot;</span></span><br><span class="line"> </span><br><span class="line"><span class="keyword">elsif</span> scheme == <span class="string">&quot;3&quot;</span></span><br><span class="line"></span><br><span class="line">    schemeName = <span class="string">&quot;Jenkins&quot;</span></span><br><span class="line">    export_method = <span class="string">&quot;ad-hoc&quot;</span></span><br><span class="line">    configuration = <span class="string">&quot;Release&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"></span><br><span class="line">    schemeName = <span class="string">&quot;Jenkins&quot;</span></span><br><span class="line">    export_method = <span class="string">&quot;app-store&quot;</span></span><br><span class="line">    configuration = <span class="string">&quot;Release&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">end</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># puts &quot;请输入版本描述:#&#123;version&#125;&quot;</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">&quot;请输入版本描述:&quot;</span></span><br><span class="line">    commit = last_git_commit</span><br><span class="line">    message = commit[<span class="symbol">:message</span>]</span><br><span class="line">    author = commit[<span class="symbol">:author</span>] <span class="comment"># author of the commit</span></span><br><span class="line">    author_email = commit[<span class="symbol">:author_email</span>] <span class="comment"># email of the author of the commit</span></span><br><span class="line">    hash = commit[<span class="symbol">:commit_hash</span>] <span class="comment"># long sha of commit</span></span><br><span class="line">    short_hash = commit[<span class="symbol">:abbreviated_commit_hash</span>] <span class="comment"># short sha of commit</span></span><br><span class="line">    <span class="comment"># desc = &quot;commit:#&#123;commit&#125;\nauthor:#&#123;author&#125;\nauthor_email:#&#123;author_email&#125;\nhash:#&#123;hash&#125;\nshort_hash:#&#123;short_hash&#125;&quot;#STDIN.gets</span></span><br><span class="line">    desc = <span class="string">&quot;<span class="subst">#&#123;message&#125;</span> &amp;#10 short_hash:<span class="subst">#&#123;short_hash&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">&quot;\n<span class="subst">#&#123;desc&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    version = get_version_number(<span class="symbol">xcodeproj:</span> <span class="string">&quot;Jenkins.xcodeproj&quot;</span>)</span><br><span class="line">    <span class="comment"># 下面的为 多 Target 的写法</span></span><br><span class="line">    <span class="comment"># version = get_version_number(xcodeproj: &quot;Jenkins.xcodeproj&quot;, target: &quot;Jenkins&quot;)</span></span><br><span class="line">    <span class="comment"># build_number = get_build_number(xcodeproj: &quot;Jenkins.xcodeproj&quot;)</span></span><br><span class="line"></span><br><span class="line">puts <span class="string">&quot;\n</span></span><br><span class="line"><span class="string">+------------------------+---------+----------------------------+</span></span><br><span class="line"><span class="string">                   \033[1;32mpacking\033[0m</span></span><br><span class="line"><span class="string">+--------------------+-----------------------+------------------+</span></span><br><span class="line"><span class="string">| schemeName            export_method          configuration    </span></span><br><span class="line"><span class="string">+--------------------+-----------------------+------------------+</span></span><br><span class="line"><span class="string">| <span class="subst">#&#123;schemeName&#125;</span>         <span class="subst">#&#123;export_method&#125;</span>          <span class="subst">#&#123;configuration&#125;</span>  </span></span><br><span class="line"><span class="string">+--------------------+-----------------------+------------------+&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">#last_component_path = &quot;#&#123;version&#125;#&#123;build_number&#125;&quot;</span></span><br><span class="line">    <span class="comment"># 最后一级 url 路径 - 这里取每次 commit 的 short_hash 值</span></span><br><span class="line">    last_component_path = <span class="string">&quot;<span class="subst">#&#123;short_hash&#125;</span>&quot;</span></span><br><span class="line">    <span class="comment"># 用来提供 ipa 内测包安装地址</span></span><br><span class="line">    url_file_path = <span class="string">&quot;https://ios.xxxxx.com.cn/app&quot;</span></span><br><span class="line">    <span class="comment"># 执行 ipa 包输出在磁盘上的目录</span></span><br><span class="line">    output_dir = <span class="string">&quot;/Users/your_user_name/Library/Tomcat/webapps/app/ipa/<span class="subst">#&#123;last_component_path&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 开始打包</span></span><br><span class="line">    gym(</span><br><span class="line">    <span class="comment"># 指定scheme</span></span><br><span class="line">    <span class="symbol">scheme:</span> <span class="string">&quot;<span class="subst">#&#123;schemeName&#125;</span>&quot;</span>,</span><br><span class="line">    <span class="comment"># 输出的ipa名称</span></span><br><span class="line">    <span class="symbol">output_name:</span><span class="string">&quot;<span class="subst">#&#123;schemeName&#125;</span>&quot;</span>,</span><br><span class="line">    <span class="comment"># 是否清空以前的编译信息 true：是</span></span><br><span class="line">    <span class="symbol">clean:</span><span class="literal">true</span>,</span><br><span class="line">    <span class="comment"># 指定打包方式，Release 或者 Debug , Test-Debug</span></span><br><span class="line">    <span class="symbol">configuration:</span><span class="string">&quot;<span class="subst">#&#123;configuration&#125;</span>&quot;</span>,</span><br><span class="line">    <span class="comment"># 指定输出文件夹</span></span><br><span class="line">    <span class="symbol">output_directory:</span><span class="string">&quot;<span class="subst">#&#123;output_dir&#125;</span>&quot;</span>,</span><br><span class="line">    <span class="comment"># 包输出配置</span></span><br><span class="line">    <span class="symbol">export_options:</span> &#123;</span><br><span class="line">        <span class="comment"># 指定打包所使用的输出方式，目前支持app-store, package, ad-hoc, enterprise, development</span></span><br><span class="line">            <span class="symbol">method:</span><span class="string">&quot;<span class="subst">#&#123;export_method&#125;</span>&quot;</span>,</span><br><span class="line">            <span class="symbol">manifest:</span> &#123;</span><br><span class="line">                <span class="symbol">appURL:</span> <span class="string">&quot;<span class="subst">#&#123;url_file_path&#125;</span>/ipa/<span class="subst">#&#123;last_component_path&#125;</span>/<span class="subst">#&#123;schemeName&#125;</span>.ipa&quot;</span>,</span><br><span class="line">                <span class="symbol">displayImageURL:</span> <span class="string">&quot;<span class="subst">#&#123;url_file_path&#125;</span>/a.png&quot;</span>,</span><br><span class="line">                <span class="symbol">fullSizeImageURL:</span> <span class="string">&quot;<span class="subst">#&#123;url_file_path&#125;</span>/b.png&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="symbol">provisioningProfiles:</span> &#123; <span class="comment"># 此两处配置 为 打 Ad-Hoc 包使用,  需要配置 打包证书 / 描述文件 上面的 `scheme` 应该改为 3</span></span><br><span class="line">              <span class="string">&quot;your app bundle id&quot;</span> =&gt; <span class="string">&quot;Jenkins_Ad_Hoc (此处文件为评估官网下载的描述文件), 存放于对应的项目 `fastlane` 文件夹下&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="symbol">codesigning_identity:</span> <span class="string">&quot;通过钥匙串查看, 打包证书(development / distribution) 证书的常用名称&quot;</span></span><br><span class="line">          &#125;</span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    sh <span class="string">&quot;node /Users/your_user_name/ipa/ios.js &#x27;your_app_name&#x27; &#x27;<span class="subst">#&#123;url_file_path&#125;</span>/ipa/<span class="subst">#&#123;last_component_path&#125;</span>/<span class="subst">#&#123;schemeName&#125;</span>.ipa&#x27; &#x27;<span class="subst">#&#123;desc&#125;</span>&#x27; &#x27;<span class="subst">#&#123;version&#125;</span>&#x27; &#x27;<span class="subst">#&#123;url_file_path&#125;</span>/ipa/<span class="subst">#&#123;last_component_path&#125;</span>/manifest.plist&#x27;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># `output_dir` 中的 `app/ipa` 为 `Tomcat` 下 `webapp` 文件夹下的子文件夹 `app/ipa` 用来存储 `ipa` 文件包</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># `url_file_path` 为 本地 `Tomcat` 下的网站, 通过 `Nginx` 转发出去的内网服务器地址</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 由于蒲公英地址被封禁, 暂时停用</span></span><br><span class="line">    <span class="comment"># puts &quot;\n</span></span><br><span class="line">    <span class="comment"># \033[1;32m-------------------------------------------\033[0m</span></span><br><span class="line">    <span class="comment"># \033[1;32m--------- 开始上传蒲公英 ---------\033[0m</span></span><br><span class="line">    <span class="comment"># \033[1;32m-------------------------------------------\033[0m&quot;</span></span><br><span class="line">    <span class="comment"># # 开始上传蒲公英</span></span><br><span class="line">    <span class="comment"># pgyer(update_description:&quot;#&#123;desc&#125;&quot;, api_key: &quot;#&#123;api_key&#125;&quot;, user_key: &quot;#&#123;user_key&#125;&quot;)</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">end</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>













































      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/12/2019/Fastlane/" data-id="clm62vf17000f6j91g4127kmy" data-title="Fastlane" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2019/H5" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/12/2019/H5/" class="article-date">
  <time class="dt-published" datetime="2019-11-12T13:44:51.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/12/2019/H5/">H5</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="H5-展示CI-并提供-APP-分发功能"><a href="#H5-展示CI-并提供-APP-分发功能" class="headerlink" title="H5 展示CI, 并提供 APP 分发功能"></a>H5 展示CI, 并提供 APP 分发功能</h4><p>编辑工具</p>
<p><a target="_blank" rel="noopener" href="https://xclient.info/s/sublime-text.html">Sublime Text 3</a></p>
<p>H5 页面搭建依赖</p>
<p><a target="_blank" rel="noopener" href="https://www.bootcss.com/">bootstrap</a></p>
<p><a target="_blank" rel="noopener" href="https://jquery.com/">jQuery</a></p>
<p><a target="_blank" rel="noopener" href="http://jeromeetienne.github.io/jquery-qrcode/">jquery.qrcode.js</a></p>
<p><a target="_blank" rel="noopener" href="http://jeromeetienne.github.com/jquery-qrcode/">jquery.qrcode.js</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bootstrap-table.com.cn/">bootstrap-table.js</a></p>
<p><a target="_blank" rel="noopener" href="https://v4.bootcss.com/docs/4.3/components/pagination/">bootstrap-paginator.js</a></p>
<p><a target="_blank" rel="noopener" href="https://www.bootstrap-table.com.cn/examples/extensions/i18n-enhance/">bootstrap-table-zh-CN.js 多语言</a></p>
<p><code>数据接口</code> <a target="_blank" rel="noopener" href="https://spring.io/tools3/sts/all">STS</a></p>
<p>一台支持 <code>HTTPS</code> 访问的服务器, 此项为必须, <code>ipa</code> 包下发需要依赖</p>
<p><a href="xxxxx.com/xxxx.html">参见 数据接口</a></p>
<p><a target="_blank" rel="noopener" href="https://help.apple.com/deployment/ios/#/apda0e3426d7">iOS 部署参考</a></p>
<h5 id="H5-页面结构"><a href="#H5-页面结构" class="headerlink" title="H5 页面结构"></a>H5 页面结构</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>接口测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1,maximum-scale=1,maximum-scale=1, user-scalable=no&quot;</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/qrCode.js&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.timeago.js&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;dist/bootstrap-table.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/ipa.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;bootstrap/css/bootstrap.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;dist/bootstrap-table.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;dist/locale/bootstrap-table-zh-CN.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;bootstrap/js/bootstrap-paginator.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 最新版本的 Bootstrap 核心 CSS 文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot;</span> <span class="attr">integrity</span>=<span class="string">&quot;sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 最新的 Bootstrap 核心 JavaScript 文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js&quot;</span> <span class="attr">integrity</span>=<span class="string">&quot;sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- APP logo 展示 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://ios.xxxxxx.com.cn/app/b.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 扫一扫二维码展示 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;qrcode&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;qrcode&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- APP 包 展示 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped table-bordered table-hover&quot;</span> <span class="attr">id</span>=<span class="string">&quot;tableL01&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;text-right&quot;</span>&gt;</span> <span class="comment">&lt;!--text-right 右对齐，bootstrap中样式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-12&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 分页控件，标签必须是&lt;ul&gt; --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;pageButton&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 页面二维码展示 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">QRCode</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;qrcode&quot;</span>), <span class="string">&quot;https://ios.xxxxxx.com.cn/app/ios.html&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>读取数据库数据方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">getPageOf</span>(<span class="params">page</span>) &#123;</span><br><span class="line">    $.<span class="title function_">ajax</span>(&#123;</span><br><span class="line">          <span class="comment">//请求方式</span></span><br><span class="line">          type : <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">          <span class="comment">//请求地址</span></span><br><span class="line">          url : <span class="string">&quot;https://ios-api.xxxxxx.com.cn/list&quot;</span>,</span><br><span class="line">          <span class="comment">//数据，json字符串</span></span><br><span class="line">          data : <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span><br><span class="line">            <span class="attr">page</span>: page,</span><br><span class="line">            <span class="attr">pageSize</span>: <span class="number">20</span>,</span><br><span class="line">            <span class="attr">platform</span>: <span class="number">1</span></span><br><span class="line">          &#125;),</span><br><span class="line">          <span class="attr">contentType</span>: <span class="string">&quot;application/json;charset=utf-8&quot;</span>,</span><br><span class="line">          <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span><br><span class="line">          <span class="comment">//请求成功</span></span><br><span class="line">          success : <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span><br><span class="line">            <span class="keyword">var</span> totalPages = res.<span class="property">totalPage</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">var</span> result = res.<span class="property">ipaList</span>;</span><br><span class="line">              </span><br><span class="line">      <span class="comment">//if(page == 1) &#123;</span></span><br><span class="line">        <span class="title function_">buildTable</span>(result, totalPages);</span><br><span class="line">      <span class="comment">//&#125;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="comment">//请求失败，包含具体的错误信息</span></span><br><span class="line">          error : <span class="keyword">function</span>(<span class="params">e</span>)&#123;</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">status</span>);</span><br><span class="line">              <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">responseText</span>);</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>表格数据构建方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// 构建表格数据</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">buildTable</span>(<span class="params">result, totalPages, current_page</span>) &#123;</span><br><span class="line">    $(<span class="string">&#x27;#tableL01&#x27;</span>).<span class="title function_">bootstrapTable</span>(<span class="string">&#x27;destroy&#x27;</span>);</span><br><span class="line">    <span class="comment">/// 构建分页控件</span></span><br><span class="line">    <span class="keyword">var</span> element = $(<span class="string">&#x27;#pageButton&#x27;</span>);</span><br><span class="line">        <span class="keyword">var</span> options = &#123;</span><br><span class="line">            bootstrapMajorVersion : <span class="number">3</span>,</span><br><span class="line">            currentPage : current_page,</span><br><span class="line">            numberOfPages : <span class="number">5</span>,</span><br><span class="line">            totalPages : totalPages,</span><br><span class="line">            itemTexts : <span class="keyword">function</span>(<span class="params">type, page, current</span>) &#123;</span><br><span class="line">                <span class="keyword">switch</span> (type) &#123;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;first&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;首页&quot;</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;prev&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;上一页&quot;</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;next&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;下一页&quot;</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;last&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">&quot;末页&quot;</span>;</span><br><span class="line">                <span class="keyword">case</span> <span class="string">&quot;page&quot;</span>:</span><br><span class="line">                    <span class="keyword">return</span> page;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="comment">// 点击事件，用于通过Ajax来刷新整个list列表</span></span><br><span class="line">            onPageClicked : <span class="keyword">function</span>(<span class="params">event, originalEvent, type, page</span>) &#123;</span><br><span class="line">                <span class="title function_">getPageOf</span>(page);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        element.<span class="title function_">bootstrapPaginator</span>(options);</span><br><span class="line"></span><br><span class="line">        <span class="comment">/// 构建表格</span></span><br><span class="line">        $(<span class="string">&#x27;#tableL01&#x27;</span>).<span class="title function_">bootstrapTable</span>(&#123;</span><br><span class="line">          <span class="attr">columns</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">checkbox</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="attr">width</span>:<span class="number">60</span>,<span class="comment">// 定义列的宽度，单位为像素px</span></span><br><span class="line">                <span class="attr">visible</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">field</span>:<span class="string">&#x27;id&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>:<span class="string">&#x27; 编号&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>:<span class="number">20</span>,</span><br><span class="line">                <span class="attr">visible</span>: <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">field</span>:<span class="string">&#x27;createTime&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>:<span class="string">&#x27;发布时间&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>:<span class="number">80</span>,</span><br><span class="line">                <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">                <span class="attr">valign</span>: <span class="string">&#x27;middle&#x27;</span>,</span><br><span class="line">                <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value, row, index</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">`&lt;span class=&quot;time&quot; title=&quot;<span class="subst">$&#123;row.createTime&#125;</span>&quot;&gt;&lt;/span&gt;`</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">field</span>:<span class="string">&#x27;title&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>:<span class="string">&#x27;名称&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>:<span class="number">50</span>,</span><br><span class="line">                <span class="attr">visible</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">field</span>:<span class="string">&#x27;des&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>:<span class="string">&#x27;描述&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>:<span class="number">100</span>,</span><br><span class="line">                <span class="comment">// visible: false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">field</span>:<span class="string">&#x27;url&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>:<span class="string">&#x27;ipa 包&#x27;</span>,</span><br><span class="line">                <span class="attr">visible</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">field</span>:<span class="string">&#x27;mainfest&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>:<span class="string">&#x27;mainfest文件&#x27;</span>,</span><br><span class="line">                <span class="attr">visible</span>: <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">field</span>:<span class="string">&#x27;ver&#x27;</span>,</span><br><span class="line">                <span class="attr">title</span>:<span class="string">&#x27;版本&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>:<span class="number">40</span>,</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span><br><span class="line">                <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>,</span><br><span class="line">                <span class="attr">valign</span>: <span class="string">&#x27;middle&#x27;</span>,</span><br><span class="line">                <span class="attr">width</span>: <span class="number">85</span>, </span><br><span class="line">                <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value, row, index</span>) &#123;</span><br><span class="line">                    <span class="keyword">return</span> <span class="string">`&lt;a class=&quot;btn btn-primary btn-lg active&quot; href=&quot;itms-services://?action=download-manifest&amp;url=<span class="subst">$&#123; row.mainfest &#125;</span>&quot;&gt;安装&lt;/a &gt;`</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        ],  <span class="comment">//表头</span></span><br><span class="line">      <span class="attr">data</span>:result, <span class="comment">//通过ajax返回的数据</span></span><br><span class="line">      <span class="comment">// width:300,</span></span><br><span class="line">      <span class="comment">// height:700,</span></span><br><span class="line">      <span class="comment">// method: &#x27;get&#x27;,</span></span><br><span class="line">      <span class="attr">pageSize</span>: <span class="number">20</span>, <span class="comment">//每页3条</span></span><br><span class="line">      <span class="attr">pageNumber</span>: <span class="number">1</span>,  <span class="comment">//第1页</span></span><br><span class="line">      <span class="comment">// cache: false,   //不缓存</span></span><br><span class="line">      <span class="comment">// striped: true,</span></span><br><span class="line">      <span class="attr">pagination</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">sidePagination</span>: <span class="string">&#x27;client&#x27;</span>,</span><br><span class="line">      <span class="attr">search</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">showRefresh</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">showExport</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">showFooter</span>: <span class="literal">false</span>,</span><br><span class="line">      <span class="attr">buttonsAlign</span>:<span class="string">&#x27;right&#x27;</span>,</span><br><span class="line">      <span class="comment">// exportTypes: [&#x27;csv&#x27;, &#x27;txt&#x27;, &#x27;xml&#x27;],</span></span><br><span class="line">      <span class="attr">clickToSelect</span>: <span class="literal">true</span>,</span><br><span class="line">      &#125;);</span><br><span class="line">      $(<span class="string">&quot;.time&quot;</span>).<span class="title function_">timeago</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最终页面结构</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>接口测试<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1,maximum-scale=1,maximum-scale=1, user-scalable=no&quot;</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">style</span> <span class="attr">type</span>=<span class="string">&quot;text/css&quot;</span>&gt;</span></span><br><span class="line">      </span><br><span class="line">    <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/qrCode.js&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/jquery.timeago.js&quot;</span> &gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;dist/bootstrap-table.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;css/ipa.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">&quot;bootstrap/css/bootstrap.css&quot;</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;dist/bootstrap-table.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;dist/locale/bootstrap-table-zh-CN.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;bootstrap/js/bootstrap-paginator.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 最新版本的 Bootstrap 核心 CSS 文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css&quot;</span> <span class="attr">integrity</span>=<span class="string">&quot;sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 最新的 Bootstrap 核心 JavaScript 文件 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js&quot;</span> <span class="attr">integrity</span>=<span class="string">&quot;sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa&quot;</span> <span class="attr">crossorigin</span>=<span class="string">&quot;anonymous&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="title function_">getPageOf</span>(<span class="number">1</span>);</span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">getPageOf</span>(<span class="params">page</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $.<span class="title function_">ajax</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">//请求方式</span></span></span><br><span class="line"><span class="language-javascript">              type : <span class="string">&quot;POST&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">//请求地址</span></span></span><br><span class="line"><span class="language-javascript">              url : <span class="string">&quot;https://ios-api.xxxxxx.com.cn/list&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">//数据，json字符串</span></span></span><br><span class="line"><span class="language-javascript">              data : <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">page</span>: page,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">pageSize</span>: <span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                <span class="attr">platform</span>: <span class="number">1</span></span></span><br><span class="line"><span class="language-javascript">              &#125;),</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">contentType</span>: <span class="string">&quot;application/json;charset=utf-8&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">dataType</span>: <span class="string">&#x27;json&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">//请求成功</span></span></span><br><span class="line"><span class="language-javascript">              success : <span class="keyword">function</span>(<span class="params">res</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="variable language_">console</span>.<span class="title function_">log</span>(res);</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> totalPages = res.<span class="property">totalPage</span>;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">var</span> result = res.<span class="property">ipaList</span>;</span></span><br><span class="line"><span class="language-javascript">                  </span></span><br><span class="line"><span class="language-javascript">          <span class="comment">//if(page == 1) &#123;</span></span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">buildTable</span>(result, totalPages);</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">//&#125;</span></span></span><br><span class="line"><span class="language-javascript">              &#125;,</span></span><br><span class="line"><span class="language-javascript">              <span class="comment">//请求失败，包含具体的错误信息</span></span></span><br><span class="line"><span class="language-javascript">              error : <span class="keyword">function</span>(<span class="params">e</span>)&#123;</span></span><br><span class="line"><span class="language-javascript">                  <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">status</span>);</span></span><br><span class="line"><span class="language-javascript">                  <span class="variable language_">console</span>.<span class="title function_">log</span>(e.<span class="property">responseText</span>);</span></span><br><span class="line"><span class="language-javascript">              &#125;</span></span><br><span class="line"><span class="language-javascript">          &#125;);</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">      <span class="comment">/// 构建表格数据</span></span></span><br><span class="line"><span class="language-javascript">      <span class="keyword">function</span> <span class="title function_">buildTable</span>(<span class="params">result, totalPages, current_page</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        $(<span class="string">&#x27;#tableL01&#x27;</span>).<span class="title function_">bootstrapTable</span>(<span class="string">&#x27;destroy&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="comment">/// 构建分页控件</span></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">var</span> element = $(<span class="string">&#x27;#pageButton&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">var</span> options = &#123;</span></span><br><span class="line"><span class="language-javascript">                bootstrapMajorVersion : <span class="number">3</span>,</span></span><br><span class="line"><span class="language-javascript">                currentPage : current_page,</span></span><br><span class="line"><span class="language-javascript">                numberOfPages : <span class="number">5</span>,</span></span><br><span class="line"><span class="language-javascript">                totalPages : totalPages,</span></span><br><span class="line"><span class="language-javascript">                itemTexts : <span class="keyword">function</span>(<span class="params">type, page, current</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">switch</span> (type) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">case</span> <span class="string">&quot;first&quot;</span>:</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> <span class="string">&quot;首页&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">case</span> <span class="string">&quot;prev&quot;</span>:</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> <span class="string">&quot;上一页&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">case</span> <span class="string">&quot;next&quot;</span>:</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> <span class="string">&quot;下一页&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">case</span> <span class="string">&quot;last&quot;</span>:</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> <span class="string">&quot;末页&quot;</span>;</span></span><br><span class="line"><span class="language-javascript">                    <span class="keyword">case</span> <span class="string">&quot;page&quot;</span>:</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> page;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                <span class="comment">// 点击事件，用于通过Ajax来刷新整个list列表</span></span></span><br><span class="line"><span class="language-javascript">                onPageClicked : <span class="keyword">function</span>(<span class="params">event, originalEvent, type, page</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="title function_">getPageOf</span>(page);</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            &#125;;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            element.<span class="title function_">bootstrapPaginator</span>(options);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">            <span class="comment">/// 构建表格</span></span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&#x27;#tableL01&#x27;</span>).<span class="title function_">bootstrapTable</span>(&#123;</span></span><br><span class="line"><span class="language-javascript">              <span class="attr">columns</span>: [</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">checkbox</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">width</span>:<span class="number">60</span>, <span class="comment">// 定义列的宽度，单位为像素px</span></span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">visible</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">field</span>:<span class="string">&#x27;id&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>:<span class="string">&#x27; 编号&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">width</span>:<span class="number">20</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">visible</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">field</span>:<span class="string">&#x27;createTime&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>:<span class="string">&#x27;发布时间&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">width</span>:<span class="number">80</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">valign</span>: <span class="string">&#x27;middle&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value, row, index</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> <span class="string">`&lt;span class=&quot;time&quot; title=&quot;<span class="subst">$&#123;row.createTime&#125;</span>&quot;&gt;&lt;/span&gt;`</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">field</span>:<span class="string">&#x27;title&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>:<span class="string">&#x27;名称&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">width</span>:<span class="number">50</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">visible</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">field</span>:<span class="string">&#x27;des&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>:<span class="string">&#x27;描述&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">width</span>:<span class="number">100</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="comment">// visible: false</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">field</span>:<span class="string">&#x27;url&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>:<span class="string">&#x27;ipa 包&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">visible</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">field</span>:<span class="string">&#x27;mainfest&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>:<span class="string">&#x27;mainfest文件&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">visible</span>: <span class="literal">false</span></span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">field</span>:<span class="string">&#x27;ver&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>:<span class="string">&#x27;版本&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">width</span>:<span class="number">40</span>,</span></span><br><span class="line"><span class="language-javascript">                &#125;,</span></span><br><span class="line"><span class="language-javascript">                &#123;</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">title</span>: <span class="string">&quot;操作&quot;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">align</span>: <span class="string">&#x27;center&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">valign</span>: <span class="string">&#x27;middle&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">width</span>: <span class="number">85</span>,</span></span><br><span class="line"><span class="language-javascript">                    <span class="attr">formatter</span>: <span class="keyword">function</span> (<span class="params">value, row, index</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                        <span class="keyword">return</span> <span class="string">`&lt;a class=&quot;btn btn-primary btn-lg active&quot; href=&quot;itms-services://?action=download-manifest&amp;url=<span class="subst">$&#123; row.mainfest &#125;</span>&quot;&gt;安装&lt;/a &gt;`</span>;</span></span><br><span class="line"><span class="language-javascript">                    &#125;</span></span><br><span class="line"><span class="language-javascript">                &#125;</span></span><br><span class="line"><span class="language-javascript">            ],  <span class="comment">//表头</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">data</span>:result, <span class="comment">//通过ajax返回的数据</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// width:300,</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// height:700,</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// method: &#x27;get&#x27;,</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">pageSize</span>: <span class="number">20</span>, <span class="comment">//每页3条</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">pageNumber</span>: <span class="number">1</span>,  <span class="comment">//第1页</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// cache: false,   //不缓存</span></span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// striped: true,</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">pagination</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">sidePagination</span>: <span class="string">&#x27;client&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">search</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">showRefresh</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">showExport</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">showFooter</span>: <span class="literal">false</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="attr">buttonsAlign</span>:<span class="string">&#x27;right&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">          <span class="comment">// exportTypes: [&#x27;csv&#x27;, &#x27;txt&#x27;, &#x27;xml&#x27;],</span></span></span><br><span class="line"><span class="language-javascript">          <span class="attr">clickToSelect</span>: <span class="literal">true</span>,</span></span><br><span class="line"><span class="language-javascript">            &#125;);</span></span><br><span class="line"><span class="language-javascript">            $(<span class="string">&quot;.time&quot;</span>).<span class="title function_">timeago</span>();</span></span><br><span class="line"><span class="language-javascript">      &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- APP logo 展示 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;logo&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;https://ios.xxxxxx.com.cn/app/b.png&quot;</span> /&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- 扫一扫二维码展示 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;qrcode&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;qrcode&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- APP 包 展示 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">&quot;table table-striped table-bordered table-hover&quot;</span> <span class="attr">id</span>=<span class="string">&quot;tableL01&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">&quot;text-right&quot;</span>&gt;</span> <span class="comment">&lt;!--text-right 右对齐，bootstrap中样式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-lg-12&quot;</span> <span class="attr">align</span>=<span class="string">&quot;center&quot;</span>&gt;</span></span><br><span class="line">          <span class="comment">&lt;!-- 分页控件，标签必须是&lt;ul&gt; --&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">ul</span> <span class="attr">id</span>=<span class="string">&quot;pageButton&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">  <span class="keyword">new</span> <span class="title class_">QRCode</span>(<span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;qrcode&quot;</span>), <span class="string">&quot;https://ios.xxxxxx.com.cn/app/ios.html&quot;</span>);</span></span><br><span class="line"><span class="language-javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>



























      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/12/2019/H5/" data-id="clm62vf18000h6j916396e5dn" data-title="H5" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2019/MySQL" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/12/2019/MySQL/" class="article-date">
  <time class="dt-published" datetime="2019-11-12T13:44:51.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/12/2019/MySQL/">MySQL</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="MySQL-数据库环境配置"><a href="#MySQL-数据库环境配置" class="headerlink" title="MySQL 数据库环境配置"></a>MySQL 数据库环境配置</h4><h5 id="工具及环境"><a href="#工具及环境" class="headerlink" title="工具及环境"></a>工具及环境</h5><p><a target="_blank" rel="noopener" href="https://xclient.info/s/navicat-for-mysql.html">Navicat For MySQL</a></p>
<p>工具为非必须, 其他图形化操作工具也可以, 也可以使用终端环境建库、建表</p>
<p>MySQL 终端环境安装</p>
<p>依赖 <code>Homebrew</code> <a target="_blank" rel="noopener" href="https://brew.sh/">Homebrew</a></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ brew install mysql</span><br></pre></td></tr></table></figure>
<p>终端环境建库、建表可以看这里<a target="_blank" rel="noopener" href="https://www.runoob.com/mysql/mysql-tutorial.html">MySQL 菜鸟教程</a></p>
<p>需要建立的表结构如下</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="comment">-- Table structure for ipaInfo</span></span><br><span class="line"><span class="comment">-- ----------------------------</span></span><br><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> IF <span class="keyword">EXISTS</span> `ipaInfo`;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> `ipaInfo` (</span><br><span class="line">  `id` <span class="type">int</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="keyword">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  `title` <span class="type">varchar</span>(<span class="number">50</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `des` <span class="type">varchar</span>(<span class="number">500</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `mainfest` <span class="type">varchar</span>(<span class="number">255</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `url` <span class="type">varchar</span>(<span class="number">200</span>) <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `ver` <span class="type">varchar</span>(<span class="number">50</span>)  <span class="keyword">DEFAULT</span> <span class="keyword">NULL</span>,</span><br><span class="line">  `createTime` <span class="type">timestamp</span> <span class="keyword">NULL</span> <span class="keyword">DEFAULT</span> <span class="built_in">CURRENT_TIMESTAMP</span>,</span><br><span class="line">  <span class="keyword">PRIMARY</span> KEY (`id`)</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<h5 id="Nodejs-插入数据"><a href="#Nodejs-插入数据" class="headerlink" title="Nodejs 插入数据"></a>Nodejs 插入数据</h5><p>依赖 <a target="_blank" rel="noopener" href="https://nodejs.org/en/">Nodejs</a></p>
<p>编写插入数据的脚本 <a target="_blank" rel="noopener" href="https://www.runoob.com/nodejs/nodejs-mysql.html">Nodejs MySQL</a></p>
<p>脚本如下 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收命令行传递的参数</span></span><br><span class="line"><span class="keyword">var</span> <span class="variable language_">arguments</span> = process.<span class="property">argv</span>.<span class="title function_">splice</span>(<span class="number">2</span>);</span><br><span class="line"><span class="keyword">var</span> title = <span class="variable language_">arguments</span>[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">var</span> url = <span class="variable language_">arguments</span>[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">var</span> desc = <span class="variable language_">arguments</span>[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">var</span> version = <span class="variable language_">arguments</span>[<span class="number">3</span>]</span><br><span class="line"><span class="keyword">var</span> mainfest = <span class="variable language_">arguments</span>[<span class="number">4</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// 插入数据</span></span><br><span class="line"><span class="keyword">var</span> mysql      = <span class="built_in">require</span>(<span class="string">&#x27;mysql&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> connection = mysql.<span class="title function_">createConnection</span>(&#123;</span><br><span class="line">  host     : <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">  user     : <span class="string">&#x27;root&#x27;</span>,</span><br><span class="line">  password : <span class="string">&#x27;password&#x27;</span>,</span><br><span class="line">  database : <span class="string">&#x27;testFlight&#x27;</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">connection.<span class="title function_">connect</span>();</span><br><span class="line"><span class="keyword">var</span>  addSql = <span class="string">&#x27;INSERT INTO ipaInfo(title, url, des, ver, mainfest) VALUES(?, ?, ?, ?, ?)&#x27;</span>;</span><br><span class="line"><span class="keyword">var</span>  addSqlParams = [title, url, desc, version, mainfest];</span><br><span class="line"></span><br><span class="line">connection.<span class="title function_">query</span>(addSql,addSqlParams,<span class="keyword">function</span> (<span class="params">err, result</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">         <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;[INSERT ERROR] - &#x27;</span>,err.<span class="property">message</span>);</span><br><span class="line">         <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="comment">//console.log(&#x27;INSERT ID:&#x27;,result.insertId);        </span></span><br><span class="line">       <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;INSERT ID:&#x27;</span>,result);        </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">connection.<span class="title function_">end</span>();</span><br></pre></td></tr></table></figure>

<p>存入数据测试, 这里只是做测试数据插入处理, 后面真实数据将由 <code>Fastlane</code> 的 <code>Ruby</code> 执行插入.</p>
<p>将脚本保存到 <code>/Users/your_user_name/ipa/</code> 文件夹下, 备用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node /Users/your_user_name/ipa/ios.js <span class="string">&#x27;APPName&#x27;</span> <span class="string">&#x27;https://.../xxxx.ipa&#x27;</span> <span class="string">&#x27;下单问题修改&#x27;</span> <span class="string">&#x27;v0.0.1&#x27;</span> <span class="string">&#x27;https://..../manifest.plist&#x27;</span></span><br></pre></td></tr></table></figure>

<p>终端输出如下, 表示插入成功</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">INSERT ID: OkPacket &#123;</span><br><span class="line">  fieldCount: 0,</span><br><span class="line">  affectedRows: 1,</span><br><span class="line">  insertId: 64,</span><br><span class="line">  serverStatus: 2,</span><br><span class="line">  warningCount: 0,</span><br><span class="line">  message: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">  protocol41: <span class="literal">true</span>,</span><br><span class="line">  changedRows: 0 &#125;</span><br></pre></td></tr></table></figure>

<p>入库数据如下</p>
<table>
<thead>
<tr>
<th align="center">id</th>
<th align="center">title</th>
<th align="center">url</th>
<th align="center">des</th>
<th align="center">ver</th>
<th align="center">mainfest</th>
<th align="center">createTime</th>
</tr>
</thead>
<tbody><tr>
<td align="center">1</td>
<td align="center">APPName</td>
<td align="center">https:&#x2F;&#x2F;…&#x2F;xxxx.ipa</td>
<td align="center">下单问题修改</td>
<td align="center">v0.0.1</td>
<td align="center">https:&#x2F;&#x2F;….&#x2F;manifest.plist</td>
<td align="center">2019-10-16 16:00:53</td>
</tr>
</tbody></table>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/12/2019/MySQL/" data-id="clm62vf18000i6j91536zcemf" data-title="MySQL" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2019/STS" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/12/2019/STS/" class="article-date">
  <time class="dt-published" datetime="2019-11-12T13:44:51.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/12/2019/STS/">STS</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="自用-CI-环境搭建"><a href="#自用-CI-环境搭建" class="headerlink" title="自用 CI 环境搭建"></a>自用 CI 环境搭建</h2><h3 id="所需工具及环境"><a href="#所需工具及环境" class="headerlink" title="所需工具及环境"></a>所需工具及环境</h3><p><code>Jenkins 官网</code> <a target="_blank" rel="noopener" href="https://jenkins.io/zh/">Jenkins</a></p>
<p><code>Nodejs 环境安装 </code> <a target="_blank" rel="noopener" href="https://nodejs.org/en/">Nodejs</a></p>
<p><code>Fastlane 官方文档</code>  <a target="_blank" rel="noopener" href="https://docs.fastlane.tools/">Fastlane 官方文档</a></p>
<p><code>Tomcat + Jenkins</code>  <a target="_blank" rel="noopener" href="http://urm9ril.top/2017/03/12/Jenkins/">参考</a></p>
<p><code>mySql 环境安装</code> <a target="_blank" rel="noopener" href="https://blog.csdn.net/w605283073/article/details/80417866">环境安装</a></p>
<p><code>STS 套件安装</code></p>
<p><a target="_blank" rel="noopener" href="https://spring.io/tools3/sts">STS</a></p>
<p><a target="_blank" rel="noopener" href="https://spring.io/guides/gs/spring-boot/">Building an Application with Spring Boot</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/12/2019/STS/" data-id="clm62vf19000j6j915a8carx3" data-title="STS" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2019/Tomcat" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/11/12/2019/Tomcat/" class="article-date">
  <time class="dt-published" datetime="2019-11-12T13:44:51.000Z" itemprop="datePublished">2019-11-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2019/11/12/2019/Tomcat/">Tomcat</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h4 id="本机Tomcat网站目录"><a href="#本机Tomcat网站目录" class="headerlink" title="本机Tomcat网站目录"></a>本机Tomcat网站目录</h4><p>以下内容为本机 <code>Tomcat</code> <code>webapp</code> 目录 <code>app</code> 文件夹下, 目录结构</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">├── a.png // Fastlane 安装 MD 下, `gym` 配置 `displayImageURL` 的文件地址</span><br><span class="line">├── android.html // `android` 内测分发网页</span><br><span class="line">├── apk // `apk` 包 存储目录</span><br><span class="line">│   ├── 0e216939</span><br><span class="line">│   │   └── android.apk</span><br><span class="line">│   └── 4c8566c2</span><br><span class="line">│       └── android.apk</span><br><span class="line">├── b.png // Fastlane 安装 MD 下, `gym` 配置 `fullSizeImageURL` 的文件地址</span><br><span class="line">├── bootstrap</span><br><span class="line">│   ├── css</span><br><span class="line">│   ├── fonts</span><br><span class="line">│   └── js</span><br><span class="line">├── css</span><br><span class="line">│   └── ipa.css</span><br><span class="line">├── dist</span><br><span class="line">│   ├── extensions</span><br><span class="line">│   ├── locale</span><br><span class="line">│   └── themes</span><br><span class="line">├── ios.html // `ios` 内测分发网页</span><br><span class="line">├── ipa // `ipa` 包 存储目录, Fastlane 安装 MD 下, `gym` 配置 `appURL` 的文件地址</span><br><span class="line">│   ├── 0076cf88 // commit short_hash 值</span><br><span class="line">│   │   ├── xxxxxx-TEST.ipa</span><br><span class="line">│   │   └── manifest.plist</span><br><span class="line">│   ├── 038e1399</span><br><span class="line">│   │   ├── xxxxxx-TEST.ipa</span><br><span class="line">│   │   └── manifest.plist</span><br><span class="line">└── js // jQuery js 插件目录</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2019/11/12/2019/Tomcat/" data-id="clm62vf19000k6j919r4igs6o" data-title="Tomcat" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-2018/Jenkins" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/03/12/2018/Jenkins/" class="article-date">
  <time class="dt-published" datetime="2018-03-12T13:29:30.000Z" itemprop="datePublished">2018-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/03/12/2018/Jenkins/">Jenkins一键发布ipa到蒲公英</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="什么是-Jenkins"><a href="#什么是-Jenkins" class="headerlink" title="什么是 Jenkins"></a>什么是 Jenkins</h2><p><code>Jenkins</code> 是一个持续集成工具，它可以在设定的某个时间点（或者代码有更新等情况）自动去构建安装包，同时可以将安装包上传到第三方平台，比如：Bugly、蒲公英，这样测试人员可以通过微信、QQ扫一扫直接安装</p>
<p>建议下载 .war文件 配合<code>Tomcat</code>环境使用.</p>
<p>直接下载了.war文件，这个文件是直接放在<code>Tomcat</code>下<code>webapps</code>目录下.</p>
<p>优点:它的权限就是当前用户.</p>
<p>开始安装<code>Tomcat</code></p>
<p>把下载好的 <code>Tomcat</code> 文件夹 放到你想放的目录</p>
<p>然后把 <code>.war</code> 文件放入<code>Tomcat</code>文件夹下的 <code>webapps</code> 目录下</p>
<h2 id="运行Jenkins"><a href="#运行Jenkins" class="headerlink" title="运行Jenkins"></a>运行<code>Jenkins</code></h2><p>命令行进入<code>Tomcat</code>安装目录.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /Users/ooops/apache-tomcat-7.0.75/bin</span><br></pre></td></tr></table></figure>
<p>可能会报 <code>-bash: /Users/ooops/apache-tomcat-7.0.75/bin/startup.sh: Permission denied</code>错误,这是因为对该文件没有执行权限造成的. 执行如下命令:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chmod</span> +x *.sh</span><br></pre></td></tr></table></figure>
<p>然后执行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sh startup.sh</span><br></pre></td></tr></table></figure>
<p>打开浏览器输入 <code>localhost:8080</code> 看到 <code>Tomcat</code>启动页面,表示<code>Tomcat</code>安装成功 进入<code>Tomcat</code>目录下 <code>conf</code>打开 <code>tomcat-users.xml</code>文件,在文件根节点结束之前添加如下配置</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">role</span> <span class="attr">rolename</span>=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">username</span>=<span class="string">&quot;admin&quot;</span> <span class="attr">password</span>=<span class="string">&quot;admin&quot;</span> <span class="attr">roles</span>=<span class="string">&quot;manager-gui&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>设置<code>Tomcat</code>的登录信息 使用如下命令重启<code>Tomcat</code></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /Users/ooops/apache-tomcat-7.0.75/bin</span><br><span class="line">sh shutdown.sh</span><br><span class="line">sh startup.sh</span><br></pre></td></tr></table></figure>
<p>再次访问 <code>localhost:8080</code> 选择 <code>Manager Apps</code> 登录<code>Tomcat</code>,选择列表中<code>Jenkins</code> 输入如下命令查看<code>Jenkins</code>初始密码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">open /Users/ooops/.jenkins/secrets/initialAdminPassword</span><br></pre></td></tr></table></figure>
<p>粘贴初始密码,点击继续,等待片刻</p>
<p>选择<code>Install suggested plugins</code> 安装推荐的 <code>Jenkins</code> 插件</p>
<p>推荐的插件安装完毕,还有我们自己需要的插件安装</p>
<p>首先进入插件管理器界面,进入方式: 系统管理-&gt;管理插件</p>
<p>在可选插件中搜索我们需要的插件,进行安装</p>
<p>GIT 环境下我们需要安装的插件有 三 个</p>
<ul>
<li>Gitlab Hook Plugin 因为我们用的是GitLab来管理源代码，Jenkins本身并没有自带GitLab插件</li>
<li>Xcode Xcode环境插件.</li>
<li>Keychains and Provisioning Profiles Management 钥匙串和证书配置</li>
</ul>
<h2 id="配置GIT"><a href="#配置GIT" class="headerlink" title="配置GIT"></a>配置GIT</h2><p>私钥文件位置 家目录下的 <code>.ssh</code> 文件夹下</p>
<p>配置 <code>GIT</code> 私钥</p>
<h2 id="钥匙串和证书配置"><a href="#钥匙串和证书配置" class="headerlink" title="钥匙串和证书配置"></a>钥匙串和证书配置</h2><p>进入方式: 系统管理-&gt;<code>Keychains and Provisioning Profiles Management</code></p>
<p>钥匙串文件路径 : <code>/Users/用户名(your user name)/Library/Keychains/login.keychain</code></p>
<p>上传钥匙串 <code>keychain</code> 和 证书描述文件 <code>Provisioning Profile</code></p>
<p>上传之后的要是串和证书描述文件会被<code>Jenkins</code></p>
<p>保存在<code>/Users/改成你的(your user name)/.jenkins/kpp_upload</code>目录下</p>
<p>配置对应的钥匙串中的开发(调试) 生产(发布) 证书</p>
<p>首先打开钥匙串,获取证书的常用名称</p>
<p>我们将证书的常用名称点入 钥匙串的配置中,具体配置参考下图</p>
<p>上图目录配置,改为<code>/Users/改成你的(your user name)/.jenkins/kpp_upload</code>.偷个懒 不补图了.</p>
<p>点击确定完成配置.</p>
<h2 id="系统全局配置"><a href="#系统全局配置" class="headerlink" title="系统全局配置"></a>系统全局配置</h2><p><code>Jenkins</code> 主页 -&gt; 系统管理 -&gt; 系统设置 -&gt; 全局属性 -&gt; 勾选<code>Keychains and</code></p>
<p><code>Provisioning Profiles Management</code> 填入上传到 <code>Jenkins</code> 的证书和描述文件目录</p>
<p><code>/Users/ooops(你的用户名)/.jenkins/kpp_upload</code></p>
<h2 id="下面开始构建项目配置"><a href="#下面开始构建项目配置" class="headerlink" title="下面开始构建项目配置."></a>下面开始构建项目配置.</h2><p>创建一个多配置的项目</p>
<h3 id="General-参数"><a href="#General-参数" class="headerlink" title="General 参数"></a>General 参数</h3><h3 id="源码管理-参数"><a href="#源码管理-参数" class="headerlink" title="源码管理 参数"></a>源码管理 参数</h3><h3 id="构建触发器设置"><a href="#构建触发器设置" class="headerlink" title="构建触发器设置"></a>构建触发器设置</h3><p>这里是设置自动化测试的地方。<br>涉及的内容很多，<br>暂时我也没有深入研究，这里暂时先不设置。<br>有自动化测试需求的可以 研究研究这里的设置。</p>
<p>不过这里两个配置还是需要是设置的</p>
<p><code>Poll SCM (poll source code management)</code> 轮询源码管理</p>
<p>需要设置源码的路径才能起到轮询的效果。</p>
<p>一般设置为类似结果： 0&#x2F;5 每5分钟轮询一次</p>
<p><code>Build periodically</code> (定时构建)</p>
<p>一般设置为类似： 00 20 * 每天 20点执行定时构建</p>
<p>格式如下 (具体可以参考后面的小问号??) 嘿嘿</p>
<p>分钟(0-59) 小时(0-23) 日期(1-31) 月(1-12) 周几(0-7,0和7都是周日)</p>
<p>设置之后文本输入域下面会有你填写格式的翻译.</p>
<p>参数配置参考：</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/xueyingqi/article/details/53216506">https://blog.csdn.net/xueyingqi/article/details/53216506</a></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/yezicjj/article/details/52763700">https://blog.csdn.net/yezicjj/article/details/52763700</a></p>
<h2 id="构建环境-参数"><a href="#构建环境-参数" class="headerlink" title="构建环境 参数"></a>构建环境 参数</h2><p>参考下图设置</p>
<p>请参考 钥匙串和证书配置 中关于钥匙串的配置.</p>
<h2 id="构建-设置"><a href="#构建-设置" class="headerlink" title="构建 设置"></a>构建 设置</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 工程名</span></span><br><span class="line">APP_NAME=<span class="string">&quot;你的项目名称&quot;</span></span><br><span class="line"><span class="comment"># 证书</span></span><br><span class="line">CODE_SIGN_DISTRIBUTION=<span class="string">&quot;iPhone Developer: XXXXXXX&quot;</span></span><br><span class="line"><span class="comment">#CODE_SIGN_DISTRIBUTION=&quot;iPhone Distribution: XXXXXXXXXX&quot;</span></span><br><span class="line"><span class="comment"># info.plist路径</span></span><br><span class="line">project_infoplist_path=<span class="string">&quot;./<span class="variable">$&#123;APP_NAME&#125;</span>/Info.plist&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#取版本号</span></span><br><span class="line">bundleShortVersion=$(/usr/libexec/PlistBuddy -c <span class="string">&quot;print CFBundleShortVersionString&quot;</span> <span class="string">&quot;<span class="variable">$&#123;project_infoplist_path&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#取build值</span></span><br><span class="line">bundleVersion=$(/usr/libexec/PlistBuddy -c <span class="string">&quot;print CFBundleVersion&quot;</span> <span class="string">&quot;<span class="variable">$&#123;project_infoplist_path&#125;</span>&quot;</span>)</span><br><span class="line"></span><br><span class="line">DATE=<span class="string">&quot;<span class="subst">$(date +%Y%m%d)</span>&quot;</span></span><br><span class="line">IPANAME=<span class="string">&quot;<span class="variable">$&#123;APP_NAME&#125;</span>_V<span class="variable">$&#123;bundleShortVersion&#125;</span>_<span class="variable">$&#123;DATE&#125;</span>.ipa&quot;</span></span><br><span class="line"><span class="comment">#IPANAME=&quot;$&#123;APP_NAME&#125;.ipa&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#要上传的ipa文件路径</span></span><br><span class="line">IPA_PATH=<span class="string">&quot;<span class="variable">$HOME</span>/<span class="variable">$&#123;IPANAME&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="variable">$&#123;IPA_PATH&#125;</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;<span class="variable">$&#123;IPA_PATH&#125;</span>&quot;</span>&gt;&gt; text.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#下面2行是没有Cocopods的用法</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;=================clean=================&quot;</span></span><br><span class="line">xcodebuild -target <span class="string">&quot;<span class="variable">$&#123;APP_NAME&#125;</span>&quot;</span>  -configuration <span class="string">&#x27;Release&#x27;</span> clean</span><br><span class="line"></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;+++++++++++++++++build+++++++++++++++++&quot;</span></span><br><span class="line">xcodebuild -target <span class="string">&quot;<span class="variable">$&#123;APP_NAME&#125;</span>&quot;</span> -sdk iphoneos -configuration <span class="string">&#x27;Release&#x27;</span> CODE_SIGN_IDENTITY=<span class="string">&quot;<span class="variable">$&#123;CODE_SIGN_DISTRIBUTION&#125;</span>&quot;</span> SYMROOT=<span class="string">&#x27;$(PWD)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#//下面2行是集成有Cocopods的用法</span></span><br><span class="line"><span class="comment">#echo &quot;=================clean=================&quot;</span></span><br><span class="line"><span class="comment">#xcodebuild -workspace &quot;$&#123;APP_NAME&#125;.xcworkspace&quot; -scheme &quot;$&#123;APP_NAME&#125;&quot;  -configuration &#x27;Release&#x27; clean</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#echo &quot;+++++++++++++++++build+++++++++++++++++&quot;</span></span><br><span class="line"><span class="comment">#xcodebuild -workspace &quot;$&#123;APP_NAME&#125;.xcworkspace&quot; -scheme &quot;$&#123;APP_NAME&#125;&quot; -sdk iphoneos -configuration &#x27;Release&#x27; CODE_SIGN_IDENTITY=&quot;$&#123;CODE_SIGN_DISTRIBUTION&#125;&quot; SYMROOT=&#x27;$(PWD)&#x27;</span></span><br><span class="line"></span><br><span class="line">xcrun -sdk iphoneos PackageApplication <span class="string">&quot;./Release-iphoneos/<span class="variable">$&#123;APP_NAME&#125;</span>.app&quot;</span> -o ~/<span class="string">&quot;<span class="variable">$&#123;IPANAME&#125;</span>&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#蒲公英上的User Key</span></span><br><span class="line">uKey=<span class="string">&quot;9b0aa78a32a......4e1ca68bdbf&quot;</span></span><br><span class="line"><span class="comment">#蒲公英上的API Key</span></span><br><span class="line">apiKey=<span class="string">&quot;ac75fcf38.....7b9f19f2e4b23&quot;</span></span><br><span class="line"><span class="comment">#要上传的ipa文件路径</span></span><br><span class="line">IPA_PATH=$(<span class="built_in">cat</span> text.txt)</span><br><span class="line"></span><br><span class="line"><span class="built_in">rm</span> -rf text.txt</span><br><span class="line"></span><br><span class="line"><span class="comment">#执行上传至蒲公英的命令</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;++++++++++++++upload+++++++++++++&quot;</span></span><br><span class="line">curl -F <span class="string">&quot;file=@<span class="variable">$&#123;IPA_PATH&#125;</span>&quot;</span> -F <span class="string">&quot;uKey=<span class="variable">$&#123;uKey&#125;</span>&quot;</span> -F <span class="string">&quot;_api_key=<span class="variable">$&#123;apiKey&#125;</span>&quot;</span> https://www.pgyer.com/apiv1/app/upload</span><br></pre></td></tr></table></figure>

<h2 id="构建项目"><a href="#构建项目" class="headerlink" title="构建项目"></a>构建项目</h2><p>以下是一次成功构建的输出信息</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">Started by user ooops</span><br><span class="line">Building <span class="keyword">in</span> workspace /Users/ooops/.jenkins/workspace/test</span><br><span class="line"> &gt; git rev-parse --is-inside-work-tree <span class="comment"># timeout=10</span></span><br><span class="line">Fetching changes from the remote Git repository //拉取GIT仓库</span><br><span class="line"> &gt; git config remote.origin.url git@github.com:xxxxx/jenkinsTest.git <span class="comment"># timeout=10</span></span><br><span class="line">Fetching upstream changes from git@github.com:xxxxx/jenkinsTest.git</span><br><span class="line"> &gt; git --version <span class="comment"># timeout=10</span></span><br><span class="line"> &gt; git fetch --tags --progress git@github.com:xxxxx/jenkinsTest.git +refs/heads/*:refs/remotes/origin/*</span><br><span class="line"> &gt; git rev-parse refs/remotes/origin/master^&#123;commit&#125; <span class="comment"># timeout=10</span></span><br><span class="line"> &gt; git rev-parse refs/remotes/origin/origin/master^&#123;commit&#125; <span class="comment"># timeout=10</span></span><br><span class="line">Checking out Revision 1f023f0132273ddc4d3d98a8283e3a15bbe254aa (refs/remotes/origin/master)</span><br><span class="line"> &gt; git config core.sparsecheckout <span class="comment"># timeout=10</span></span><br><span class="line"> &gt; git checkout -f 1f023f0132273ddc4d3d98a8283e3a15bbe254aa</span><br><span class="line"> &gt; git rev-list 1f023f0132273ddc4d3d98a8283e3a15bbe254aa <span class="comment"># timeout=10</span></span><br><span class="line">[<span class="built_in">test</span>] $ /bin/sh -xe /Users/ooops/apache-tomcat-7.0.75/temp/hudson6997647762219224773.sh</span><br><span class="line">+ APP_NAME=jenkinsTest</span><br><span class="line">+ CODE_SIGN_DISTRIBUTION=<span class="string">&#x27;iPhone Developer: xxxxx&#x27;</span></span><br><span class="line">+ project_infoplist_path=./jenkinsTest/Info.plist</span><br><span class="line">++ /usr/libexec/PlistBuddy -c <span class="string">&#x27;print CFBundleShortVersionString&#x27;</span> ./jenkinsTest/Info.plist</span><br><span class="line">+ bundleShortVersion=1.0</span><br><span class="line">++ /usr/libexec/PlistBuddy -c <span class="string">&#x27;print CFBundleVersion&#x27;</span> ./jenkinsTest/Info.plist</span><br><span class="line">+ bundleVersion=1</span><br><span class="line">++ <span class="built_in">date</span> +%Y%m%d</span><br><span class="line">+ DATE=20170312</span><br><span class="line">+ IPANAME=jenkinsTest_V1.0_20170312.ipa</span><br><span class="line">+ IPA_PATH=/Users/ooops/jenkinsTest_V1.0_20170312.ipa</span><br><span class="line">+ <span class="built_in">echo</span> /Users/ooops/jenkinsTest_V1.0_20170312.ipa</span><br><span class="line">/Users/ooops/jenkinsTest_V1.0_20170312.ipa</span><br><span class="line">+ <span class="built_in">echo</span> /Users/ooops/jenkinsTest_V1.0_20170312.ipa</span><br><span class="line">+ <span class="built_in">echo</span> =================clean=================</span><br><span class="line">=================clean=================</span><br><span class="line">+ xcodebuild -target jenkinsTest -configuration Release clean</span><br><span class="line">2017-03-12 12:56:15.278 xcodebuild[12363:1935879] [MT] PluginLoading: Required plug-in compatibility UUID DAxxxD8-C509-4xB-8xx5-84xxxxxxx701 <span class="keyword">for</span> plug-in at path <span class="string">&#x27;~/Library/Application Support/Developer/Shared/Xcode/Plug-ins/VVDocumenter-Xcode.xcplugin&#x27;</span> not present <span class="keyword">in</span> DVTPlugInCompatibilityUUIDs</span><br><span class="line">2017-03-12 12:56:15.279 xcodebuild[12363:1935879] [MT] PluginLoading: Required plug-in compatibility UUID DAxxxD8-C509-4xB-8xx5-84xxxxxxx701 <span class="keyword">for</span> plug-in at path <span class="string">&#x27;~/Library/Application Support/Developer/Shared/Xcode/Plug-ins/HOStringSense.xcplugin&#x27;</span> not present <span class="keyword">in</span> DVTPlugInCompatibilityUUIDs</span><br><span class="line">2017-03-12 12:56:15.280 xcodebuild[12363:1935879] [MT] PluginLoading: Required plug-in compatibility UUID DAxxxD8-C509-4xB-8xx5-84xxxxxxx701 <span class="keyword">for</span> plug-in at path <span class="string">&#x27;~/Library/Application Support/Developer/Shared/Xcode/Plug-ins/ESJsonFormat.xcplugin&#x27;</span> not present <span class="keyword">in</span> DVTPlugInCompatibilityUUIDs</span><br><span class="line">2017-03-12 12:56:15.280 xcodebuild[12363:1935879] [MT] PluginLoading: Required plug-in compatibility UUID DAxxxD8-C509-4xB-8xx5-84xxxxxxx701 <span class="keyword">for</span> plug-in at path <span class="string">&#x27;~/Library/Application Support/Developer/Shared/Xcode/Plug-ins/Auto-Importer.xcplugin&#x27;</span> not present <span class="keyword">in</span> DVTPlugInCompatibilityUUIDs</span><br><span class="line">=== CLEAN TARGET jenkinsTest OF PROJECT jenkinsTest WITH CONFIGURATION Release ===</span><br><span class="line"></span><br><span class="line">Check dependencies</span><br><span class="line"></span><br><span class="line">Create product structure</span><br><span class="line">/bin/mkdir -p /Users/ooops/.jenkins/workspace/test/build/Release-iphoneos/jenkinsTest.app</span><br><span class="line"></span><br><span class="line">Clean.Remove clean build/jenkinsTest.build/Release-iphoneos/jenkinsTest.build</span><br><span class="line">    builtin-rm -rf /Users/ooops/.jenkins/workspace/test/build/jenkinsTest.build/Release-iphoneos/jenkinsTest.build</span><br><span class="line"></span><br><span class="line">Clean.Remove clean build/Release-iphoneos/jenkinsTest.app</span><br><span class="line">    builtin-rm -rf /Users/ooops/.jenkins/workspace/test/build/Release-iphoneos/jenkinsTest.app</span><br><span class="line"></span><br><span class="line">Clean.Remove clean build/Release-iphoneos/jenkinsTest.app.dSYM</span><br><span class="line">    builtin-rm -rf /Users/ooops/.jenkins/workspace/test/build/Release-iphoneos/jenkinsTest.app.dSYM</span><br><span class="line"></span><br><span class="line">** CLEAN SUCCEEDED **</span><br><span class="line"></span><br><span class="line">+ <span class="built_in">echo</span> +++++++++++++++++build+++++++++++++++++</span><br><span class="line">+++++++++++++++++build+++++++++++++++++</span><br><span class="line">+ xcodebuild -target jenkinsTest -sdk iphoneos -configuration Release <span class="string">&#x27;CODE_SIGN_IDENTITY=iPhone Developer: xxxxxxxxxxxxxxxx&#x27;</span> <span class="string">&#x27;SYMROOT=$(PWD)&#x27;</span></span><br><span class="line">2017-03-12 12:56:16.118 xcodebuild[12376:1936105] [MT] PluginLoading: Required plug-in compatibility UUID DAxxxx8-C509-4xxB-8B55-84AxxxxxE701 <span class="keyword">for</span> plug-in at path <span class="string">&#x27;~/Library/Application Support/Developer/Shared/Xcode/Plug-ins/VVDocumenter-Xcode.xcplugin&#x27;</span> not present <span class="keyword">in</span> DVTPlugInCompatibilityUUIDs</span><br><span class="line">2017-03-12 12:56:16.119 xcodebuild[12376:1936105] [MT] PluginLoading: Required plug-in compatibility UUID DAxxxxD8-C509-4D8B-8xxxx-84Axxxx01 <span class="keyword">for</span> plug-in at path <span class="string">&#x27;~/Library/Application Support/Developer/Shared/Xcode/Plug-ins/HOStringSense.xcplugin&#x27;</span> not present <span class="keyword">in</span> DVTPlugInCompatibilityUUIDs</span><br><span class="line">2017-03-12 12:56:16.119 xcodebuild[12376:1936105] [MT] PluginLoading: Required plug-in compatibility UUID DA4xxx8-C509-4Dxx-8xx5-84AxxxE701 <span class="keyword">for</span> plug-in at path <span class="string">&#x27;~/Library/Application Support/Developer/Shared/Xcode/Plug-ins/ESJsonFormat.xcplugin&#x27;</span> not present <span class="keyword">in</span> DVTPlugInCompatibilityUUIDs</span><br><span class="line">2017-03-12 12:56:16.120 xcodebuild[12376:1936105] [MT] PluginLoading: Required plug-in compatibility UUID Dxxxx8-C509-xx-8B55-84xxxxxAE701 <span class="keyword">for</span> plug-in at path <span class="string">&#x27;~/Library/Application Support/Developer/Shared/Xcode/Plug-ins/Auto-Importer.xcplugin&#x27;</span> not present <span class="keyword">in</span> DVTPlugInCompatibilityUUIDs</span><br><span class="line">Build settings from <span class="built_in">command</span> line:</span><br><span class="line">    CODE_SIGN_IDENTITY = iPhone Developer: qiang zhang (36XGYU49EQ)</span><br><span class="line">    SDKROOT = iphoneos10.1</span><br><span class="line">    SYMROOT = $(PWD)</span><br><span class="line"></span><br><span class="line">=== BUILD TARGET jenkinsTest OF PROJECT jenkinsTest WITH CONFIGURATION Release ===</span><br><span class="line"></span><br><span class="line">Check dependencies</span><br><span class="line"></span><br><span class="line">Validate Release-iphoneos/jenkinsTest.app</span><br><span class="line">    <span class="built_in">cd</span> /Users/ooops/.jenkins/workspace/test</span><br><span class="line">    <span class="built_in">export</span> PATH=<span class="string">&quot;/Applications/Xcode.app/Contents/Developer/Platforms/iPhoneOS.platform/Developer/usr/bin:/Applications/Xcode.app/Contents/Developer/usr/bin:/Users/ooops/.rvm/gems/ruby-2.2.2/bin:/Users/ooops/.rvm/gems/ruby-2.2.2@global/bin:/Users/ooops/.rvm/rubies/ruby-2.2.2/bin:/usr/local/bin:/usr/bin:/bin:/usr/sbin:/sbin:/Users/ooops/.rvm/bin:/Users/ooops/.rvm/bin&quot;</span></span><br><span class="line">    <span class="built_in">export</span> PRODUCT_TYPE=com.apple.product-type.application</span><br><span class="line">    builtin-validationUtility /Users/ooops/.jenkins/workspace/test/Release-iphoneos/jenkinsTest.app -validate-for-store</span><br><span class="line"></span><br><span class="line">** BUILD SUCCEEDED **</span><br><span class="line"></span><br><span class="line">+ xcrun -sdk iphoneos PackageApplication ./Release-iphoneos/jenkinsTest.app -o /Users/ooops/jenkinsTest_V1.0_20170312.ipa</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">warning: PackageApplication is deprecated, use `xcodebuild -exportArchive` instead.</span><br><span class="line"></span><br><span class="line">//这里是上传蒲公英的配置.</span><br><span class="line">+ uKey=9b0aa78a32........64e1ca68bdbf</span><br><span class="line">+ apiKey=ac75fcf3..........a47b9f19f2e4b23</span><br><span class="line">++ <span class="built_in">cat</span> text.txt</span><br><span class="line">+ IPA_PATH=/Users/ooops/jenkinsTest_V1.0_20170312.ipa</span><br><span class="line">+ <span class="built_in">rm</span> -rf text.txt</span><br><span class="line">+ <span class="built_in">echo</span> ++++++++++++++upload+++++++++++++</span><br><span class="line">++++++++++++++upload+++++++++++++</span><br><span class="line">+ curl -F file=@/Users/ooops/jenkinsTest_V1.0_20170312.ipa -F uKey=9b0aa78a32...af26..4e1ca68bdbf -F _api_key=ac75fcf38f2.........19f2e4b23 http://www.pgyer.com/apiv1/app/upload</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line"></span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0</span><br><span class="line">100 32843    0     0  100 32843      0  21213  0:00:01  0:00:01 --:--:-- 21202</span><br><span class="line">100 32843    0     0  100 32843      0  12862  0:00:02  0:00:02 --:--:-- 12859</span><br><span class="line">100 33438  100   595  100 32843    220  12149  0:00:02  0:00:02 --:--:-- 12146</span><br><span class="line">&#123;<span class="string">&quot;code&quot;</span>:0,<span class="string">&quot;message&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;data&quot;</span>:&#123;<span class="string">&quot;appKey&quot;</span>:<span class="string">&quot;dd580f5...........0305ac671&quot;</span>,<span class="string">&quot;userKey&quot;</span>:<span class="string">&quot;9b0aa78a.........e1ca68bdbf&quot;</span>,<span class="string">&quot;appType&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;appIsLastest&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;appFileSize&quot;</span>:<span class="string">&quot;32368&quot;</span>,<span class="string">&quot;appName&quot;</span>:<span class="string">&quot;jenkinsTest&quot;</span>,<span class="string">&quot;appVersion&quot;</span>:<span class="string">&quot;1.0&quot;</span>,<span class="string">&quot;appVersionNo&quot;</span>:<span class="string">&quot;1&quot;</span>,<span class="string">&quot;appBuildVersion&quot;</span>:<span class="string">&quot;2&quot;</span>,<span class="string">&quot;appIdentifier&quot;</span>:<span class="string">&quot;com.ooops.pull&quot;</span>,<span class="string">&quot;appIcon&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;appDescription&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;appUpdateDescription&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;appScreenshots&quot;</span>:<span class="string">&quot;&quot;</span>,<span class="string">&quot;appShortcutUrl&quot;</span>:<span class="string">&quot;nZwg&quot;</span>,<span class="string">&quot;appCreated&quot;</span>:<span class="string">&quot;2017-03-12 12:56:18&quot;</span>,<span class="string">&quot;appUpdated&quot;</span>:<span class="string">&quot;2017-03-12 12:56:18&quot;</span>,<span class="string">&quot;appQRCodeURL&quot;</span>:<span class="string">&quot;http:\/\/static.pgyer.com\/app\/qrcodeHistory\/ea895709d0e57a4a8e4c8f57811838b2ce985322a94f9443e64a0937c6d29e30&quot;</span>&#125;&#125;Finished: SUCCESS</span><br></pre></td></tr></table></figure>
<p>上传到蒲公英</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/03/12/2018/Jenkins/" data-id="clm62vf0y00036j914kwt63r3" data-title="Jenkins一键发布ipa到蒲公英" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="ios-2018/CustomUILabel" class="h-entry article article-type-ios" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/01/27/2018/CustomUILabel/" class="article-date">
  <time class="dt-published" datetime="2018-01-27T07:18:14.000Z" itemprop="datePublished">2018-01-27</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2018/01/27/2018/CustomUILabel/">自定义控件-UILabel</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>开发中经常会遇到 图文混排</p>
<p>这样的界面,当然你可以使用UIButton来实现.</p>
<p>想着折腾一下</p>
<p>使用自定义UILabel的子类来实现一样的效果,代码如下</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">EIconEdgeDirection</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> left</span><br><span class="line">    <span class="keyword">case</span> right</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">IconEdgeInsetsLabel</span>: <span class="title class_">UILabel</span> &#123;</span><br><span class="line">    <span class="comment">/// UIView 灵活多变</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> iconView: <span class="type">UIView</span>? &#123;</span><br><span class="line">        <span class="keyword">didSet</span>&#123;</span><br><span class="line">            <span class="keyword">if</span> oldIconView <span class="operator">!=</span> <span class="literal">nil</span> <span class="operator">&amp;&amp;</span> oldIconView<span class="operator">!</span>.isKind(of: <span class="type">UIView</span>.<span class="keyword">self</span>) &#123;</span><br><span class="line">                oldIconView<span class="operator">?</span>.removeFromSuperview()</span><br><span class="line">            &#125;</span><br><span class="line">            oldIconView <span class="operator">=</span> iconView</span><br><span class="line">            iconView<span class="operator">!</span>.x <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line">            iconView<span class="operator">!</span>.y <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line">            addSubview(iconView<span class="operator">!</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> edgeInsets: <span class="type">UIEdgeInsets</span> <span class="operator">=</span> <span class="type">UIEdgeInsets</span>.zero</span><br><span class="line">    <span class="comment">/// iconView 默认在左边</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> direction: <span class="type">EIconEdgeDirection</span> <span class="operator">=</span> .left</span><br><span class="line">    <span class="comment">/// 用于调整iconView 和 文字 之间的间距</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">var</span> gap: <span class="type">CGFloat</span> <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">var</span> oldIconView: <span class="type">UIView</span>?</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">sizeToFit</span>(<span class="keyword">_</span> <span class="params">text</span>: <span class="type">String</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.text <span class="operator">=</span> text</span><br><span class="line">        <span class="keyword">self</span>.sizeToFit()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">func</span> <span class="title function_">sizeToFit</span>(<span class="params">attributeText</span>: <span class="type">NSAttributedString</span>) &#123;</span><br><span class="line">        <span class="keyword">self</span>.attributedText <span class="operator">=</span> attributedText</span><br><span class="line">        <span class="keyword">self</span>.sizeToFit()</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">drawText</span>(<span class="params">in</span> <span class="params">rect</span>: <span class="type">CGRect</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> insets <span class="operator">=</span> <span class="keyword">self</span>.edgeInsets</span><br><span class="line">        <span class="keyword">if</span> iconView <span class="operator">!=</span> <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">self</span>.direction <span class="operator">==</span> .left &#123;</span><br><span class="line">                iconView<span class="operator">?</span>.left      <span class="operator">=</span> insets.left</span><br><span class="line">                iconView<span class="operator">?</span>.centerY   <span class="operator">=</span> <span class="keyword">self</span>.middleY</span><br><span class="line">                insets <span class="operator">=</span> <span class="type">UIEdgeInsets</span>(top: insets.top, left: insets.left <span class="operator">+</span> gap <span class="operator">+</span> iconView<span class="operator">!</span>.width, bottom: insets.bottom, right: insets.right)</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> <span class="keyword">self</span>.direction <span class="operator">==</span> .right &#123;</span><br><span class="line">                iconView<span class="operator">?</span>.right <span class="operator">=</span> <span class="keyword">self</span>.width <span class="operator">-</span> insets.right</span><br><span class="line">                iconView<span class="operator">?</span>.centerY <span class="operator">=</span> <span class="keyword">self</span>.middleY</span><br><span class="line">                insets <span class="operator">=</span> <span class="type">UIEdgeInsets</span>(top: insets.top, left: insets.left, bottom: insets.bottom, right: insets.right <span class="operator">+</span> gap <span class="operator">+</span> (iconView<span class="operator">?</span>.width)<span class="operator">!</span>)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">super</span> .drawText(in: <span class="type">UIEdgeInsetsInsetRect</span>(rect, insets))</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">func</span> <span class="title function_">textRect</span>(<span class="params">forBounds</span> <span class="params">bounds</span>: <span class="type">CGRect</span>, <span class="params">limitedToNumberOfLines</span> <span class="params">numberOfLines</span>: <span class="type">Int</span>) -&gt; <span class="type">CGRect</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> insets <span class="operator">=</span> <span class="keyword">self</span>.edgeInsets</span><br><span class="line">        <span class="keyword">var</span> rect <span class="operator">=</span> <span class="keyword">super</span>.textRect(forBounds: <span class="type">UIEdgeInsetsInsetRect</span>(bounds, insets), limitedToNumberOfLines: numberOfLines)</span><br><span class="line">        </span><br><span class="line">        rect.origin.x       <span class="operator">-=</span> insets.left</span><br><span class="line">        rect.origin.y       <span class="operator">-=</span> insets.top</span><br><span class="line">        rect.size.height    <span class="operator">+=</span> (insets.top <span class="operator">+</span> insets.bottom)</span><br><span class="line">        <span class="keyword">if</span> iconView <span class="operator">!=</span> <span class="literal">nil</span> <span class="operator">&amp;&amp;</span> iconView<span class="operator">!</span>.isKind(of: <span class="type">UIView</span>.<span class="keyword">self</span>) &#123;</span><br><span class="line">            rect.size.width <span class="operator">+=</span> (insets.left <span class="operator">+</span> insets.right <span class="operator">+</span> gap <span class="operator">+</span> iconView<span class="operator">!</span>.width)</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            rect.size.width <span class="operator">+=</span> (insets.left <span class="operator">+</span> insets.right)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> rect</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>.h</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">enum</span> : <span class="built_in">NSUInteger</span> &#123;</span><br><span class="line">    kIconAtLeft,</span><br><span class="line">    kIconAtRight,</span><br><span class="line">    </span><br><span class="line">&#125; EIconEdgeDirection;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">IconEdgeInsetsLabel</span> : <span class="title">UILabel</span></span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">UIView</span>             *iconView;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>)         <span class="built_in">UIEdgeInsets</span>        edgeInsets;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>)         EIconEdgeDirection  direction;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>)         <span class="built_in">CGFloat</span>             gap;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>

<p><code>.m</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="string">&quot;IconEdgeInsetsLabel.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">IconEdgeInsetsLabel</span> ()</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">UIView</span>  *oldIconView;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">IconEdgeInsetsLabel</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">CGRect</span>)textRectForBounds:(<span class="built_in">CGRect</span>)bounds limitedToNumberOfLines:(<span class="built_in">NSInteger</span>)numberOfLines &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIEdgeInsets</span> insets = <span class="keyword">self</span>.edgeInsets;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">CGRect</span> rect = [<span class="variable language_">super</span> textRectForBounds:<span class="built_in">UIEdgeInsetsInsetRect</span>(bounds, insets) limitedToNumberOfLines:numberOfLines];</span><br><span class="line">    </span><br><span class="line">    rect.origin.x    -= insets.left;</span><br><span class="line">    rect.origin.y    -= insets.top;</span><br><span class="line">    rect.size.height += (insets.top + insets.bottom);</span><br><span class="line">    _iconView &amp;&amp; [_iconView isKindOfClass:[<span class="built_in">UIView</span> <span class="keyword">class</span>]] ?</span><br><span class="line">    (rect.size.width += (insets.left + insets.right + _gap + _iconView.frame.size.width)) :</span><br><span class="line">    (rect.size.width += (insets.left + insets.right));</span><br><span class="line">    <span class="keyword">return</span> rect;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)drawTextInRect:(<span class="built_in">CGRect</span>)rect &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="built_in">UIEdgeInsets</span> insets = <span class="keyword">self</span>.edgeInsets;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.iconView) &#123;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.direction == kIconAtLeft) &#123;</span><br><span class="line">            _iconView.left    = insets.left;</span><br><span class="line">            _iconView.centerY = <span class="keyword">self</span>.middleY;</span><br><span class="line">            insets = <span class="built_in">UIEdgeInsetsMake</span>(insets.top, insets.left + _gap + _iconView.frame.size.width, insets.bottom, insets.right);</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">self</span>.direction == kIconAtRight) &#123;</span><br><span class="line">        </span><br><span class="line">            _iconView.right   = <span class="keyword">self</span>.width - insets.right;</span><br><span class="line">            _iconView.centerY = <span class="keyword">self</span>.middleY;</span><br><span class="line">            insets = <span class="built_in">UIEdgeInsetsMake</span>(insets.top, insets.left, insets.bottom, insets.right  + _gap + _iconView.frame.size.width);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    [<span class="variable language_">super</span> drawTextInRect:<span class="built_in">UIEdgeInsetsInsetRect</span>(rect, insets)];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)sizeToFitWithText:(<span class="built_in">NSString</span> *)text &#123;</span><br><span class="line">    <span class="keyword">self</span>.text = text;</span><br><span class="line">    [<span class="keyword">self</span> sizeToFit];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)sizeToFitWithAttrText:(<span class="built_in">NSAttributedString</span> *)text &#123;</span><br><span class="line">    <span class="keyword">self</span>.attributedText = text;</span><br><span class="line">    [<span class="keyword">self</span> sizeToFit];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">pragma</span> mark - setter &amp; getter.</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@synthesize</span> iconView = _iconView;</span><br><span class="line"></span><br><span class="line">- (<span class="type">void</span>)setIconView:(<span class="built_in">UIView</span> *)iconView &#123;</span><br><span class="line">    _oldIconView &amp;&amp; [_oldIconView isKindOfClass:[<span class="built_in">UIView</span> <span class="keyword">class</span>]] ? ([_oldIconView removeFromSuperview]) : <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    _iconView    = iconView;</span><br><span class="line">    _oldIconView = iconView;</span><br><span class="line">    iconView.x   = <span class="number">0.</span>f;</span><br><span class="line">    iconView.y   = <span class="number">0.</span>f;</span><br><span class="line">    </span><br><span class="line">    [<span class="keyword">self</span> addSubview:iconView];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="built_in">UIView</span> *)iconView &#123;</span><br><span class="line">    <span class="keyword">return</span> _iconView;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>那么实际中如何使用呢?</p>
<p><code>swift</code></p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">lazy</span> <span class="keyword">var</span> vipTypeLabel: <span class="type">IconEdgeInsetsLabel</span> <span class="operator">=</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> l: <span class="type">IconEdgeInsetsLabel</span> <span class="operator">=</span> <span class="type">IconEdgeInsetsLabel</span>()</span><br><span class="line">    l.textColor <span class="operator">=</span> <span class="type">UIColor</span>(hex: <span class="number">0xFF8A00</span>)</span><br><span class="line">    l.backgroundColor <span class="operator">=</span> .white</span><br><span class="line">    l.layer.cornerRadius <span class="operator">=</span> <span class="number">2</span></span><br><span class="line">    l.layer.masksToBounds <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line">    l.text <span class="operator">=</span> <span class="string">&quot;零售价&quot;</span></span><br><span class="line">    l.edgeInsets <span class="operator">=</span> <span class="type">UIEdgeInsets</span>(top: <span class="number">1</span>, left: <span class="number">2</span>, bottom: <span class="number">1</span>, right: <span class="number">2</span>)</span><br><span class="line">    l.textAlignment <span class="operator">=</span> .center</span><br><span class="line">    l.iconView <span class="operator">=</span> <span class="type">UIImageView</span>(image: <span class="type">UIImage</span>.<span class="keyword">init</span>(named: <span class="string">&quot;img_name&quot;</span>))</span><br><span class="line">    l.direction <span class="operator">=</span> .right</span><br><span class="line">    <span class="keyword">return</span> l</span><br><span class="line">&#125;()</span><br></pre></td></tr></table></figure>
<p><code>oc</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">- (IconEdgeInsetsLabel *)iconLabel &#123;</span><br><span class="line">    <span class="keyword">if</span>(_iconLabel) <span class="keyword">return</span> _iconLabel;</span><br><span class="line">    <span class="built_in">UIImageView</span> *imageView = [[<span class="built_in">UIImageView</span> alloc] initWithFrame:<span class="built_in">CGRectMake</span>(<span class="number">0</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">12</span>)];</span><br><span class="line">    imageView.image        = [<span class="built_in">UIImage</span> imageNamed:<span class="string">@&quot;right_arrow_orange&quot;</span>];</span><br><span class="line">    _iconLabel = [IconEdgeInsetsLabel new];</span><br><span class="line">    _iconLabel.direction            = kIconAtRight;</span><br><span class="line">    _iconLabel.gap                  = <span class="number">4</span>;</span><br><span class="line">    _iconLabel.iconView             = imageView;</span><br><span class="line">    _iconLabel.textColor            = HEXCOLOR(<span class="number">0xFF8A00</span>);</span><br><span class="line">    _iconLabel.font                 = SystemFontWithPxSize(<span class="number">14.</span>f);</span><br><span class="line">    _iconLabel.textAlignment        = <span class="built_in">NSTextAlignmentCenter</span>;</span><br><span class="line">    <span class="keyword">return</span> _iconLabel;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>参考</p>
<p>textrectforbounds limitedtonumberoflines<br><a target="_blank" rel="noopener" href="https://developer.apple.com/documentation/uikit/uilabel/1620545-textrectforbounds">https://developer.apple.com/documentation/uikit/uilabel/1620545-textrectforbounds</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2018/01/27/2018/CustomUILabel/" data-id="clm62vf0x00026j9126qcf61c" data-title="自定义控件-UILabel" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/cordova/" rel="tag">cordova</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/vue/" rel="tag">vue</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/cordova/" style="font-size: 10px;">cordova</a> <a href="/tags/vue/" style="font-size: 10px;">vue</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/05/">May 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/08/">August 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/06/">June 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/05/">May 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/10/">October 2016</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/06/">June 2015</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/05/11/2023/CTMediator/">CTMediator 组件完整性检查工具</a>
          </li>
        
          <li>
            <a href="/2019/11/12/2019/CI_ENV/">自用 CI 环境搭建</a>
          </li>
        
          <li>
            <a href="/2019/11/12/2019/DataBase/">DataBase</a>
          </li>
        
          <li>
            <a href="/2019/11/12/2019/Fastlane/">Fastlane</a>
          </li>
        
          <li>
            <a href="/2019/11/12/2019/H5/">H5</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>